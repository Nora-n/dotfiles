\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cours-preambule}
\RequirePackage{locdef}
% \RequirePackage{luatextra}

\RequirePackage[authoryear]{natbib}
\setcitestyle{aysep={}}
\setcitestyle{citesep={~;}}
\RequirePackage[utf8x]{inputenc}
\RequirePackage[T1]{fontenc}
\RequirePackage[french]{babel}
% Pour l'alphabet phonétique international TIPA
% \RequirePackage{tipa}
% Enlever l'espace après la virgule pour les nombres
\RequirePackage{icomma}
\frenchbsetup{StandardLists=true}

% Symbols
\RequirePackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\newcommand{\hand}{\ding{45}}%
% Knuth and danger \dbend
\RequirePackage{manfnt}
% Selfmade with stackrel
% https://tex.stackexchange.com/a/483175/284518
\RequirePackage{stackengine}
\RequirePackage{scalerel}
\newcommand\danger[1][2ex]{%
	\scaleto{\stackengine{0.3pt}{\scalebox{1.1}[.9]{%
				\color{black}$\blacktriangle$}}{\color{white}\tiny\bfseries !}{O}{c}{F}{F}{L}}{#1}%
}

% Test adding text
\RequirePackage{lipsum}

% Better file and folder management
\RequirePackage[v1]{subfiles}
% To make a landscape document
\RequirePackage{pdflscape}
% Define margins globally
\RequirePackage[hmargin=1.5cm, vmargin=1.5cm]{geometry}
% Don't stretch spaces to fill the page
\raggedbottom
% To locally change margins
\RequirePackage{changepage}
% To resize tables inside threeparttable for instance
\RequirePackage{adjustbox}
% For frames in multiple lines
\RequirePackage{framed}
% For better vectors
\RequirePackage{esvect}

\RequirePackage{lastpage}
%%% En-tête et pied de page
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{1pt}
\fancyhead[RE]{\nouppercase\leftmark}  % Top (head) right (R) even (E): chapter
\fancyhead[LE]{\thepage}               % Top left even: page
\fancyhead[LO]{\nouppercase\rightmark} % Top (head) left (L) odd (O): chapter
\fancyhead[RO]{\thepage}               % Top right even: page
\fancyfoot[L]{Lycée \textsc{Pothier}}
\fancyfoot[C]{\textbf{\thepage/\pageref*{LastPage}}}
\fancyfoot[R]{MPSI -- 2023/2024}
%\fancyfoot{}                           % Empty footer
\renewcommand{\footrulewidth}{1pt}
% Space before ruler
%\setlength{\headheight}{28pt}

% Redefine the plain page style for chapter pages
\fancypagestyle{plain}{%
	\renewcommand{\headrulewidth}{0pt}  % Line at the header invisible
	\fancyhf{}%
	\fancyfoot[L]{Lycée \textsc{Pothier}}
	\fancyfoot[C]{\textbf{\thepage/\pageref*{LastPage}}}
	\fancyfoot[R]{MPSI -- 2023/2024}
	\renewcommand{\footrulewidth}{1pt}% Line at the footer visible
}

% Make sure empty pages between chapters don't have a ruler
\RequirePackage{emptypage}
% Float pages empty
\RequirePackage{floatpag}
\floatpagestyle{fancy}
% Force float Here
\RequirePackage{float}

% Colors
\RequirePackage[svgnames, dvipsnames, table]{xcolor}
\definecolor{urlcolor}{rgb}{0,0,1}
\definecolor{dgreen}{rgb}{.1,.6,.1}
\definecolor{brandeisblue}{rgb}{0.0, 0.44, 1.0}
\definecolor{cornflowerblue}{rgb}{0.3921, 0.5843, 0.9294}
\definecolor{limegreen}{rgb}{0.2, 0.8, 0.2}
\definecolor{firebrick}{rgb}{0.7, 0.13, 0.13}

% For \cancel and \bcancel functions
\RequirePackage{cancel}
\newcommand{\dcancel}[1]{
	\cancel{\bcancel{#1}}
}
% Lots of useful shorthands
\let\mdiv\div % save ./. symbol before divergence
\RequirePackage{physics}
\undef{\div}
\newcommand{\gd}{\vv{\rm grad}\,}
\def\div{\rm div\,}
\def\rot{\vv{\rm rot}\,}
\def\nab{\nabla}
\def\nabf{\vv{\nab}}
\def\vgrad{\left(\vf\cdot\grad\right)}
\newcommand{\vnabf}{\mqty(\pdv{x}\\\pdv{y}\\\pdv{z})}
\newcommand{\Vnabf}{\mqty(\DS\pdv{x}\\[1em]\DS\pdv{y}\\[1em]\DS\pdv{z})}
\NewDocumentCommand{\lap}{g}{
	\IfNoValueTF{#1}{
		\left(\pdv[2]{x} + \pdv[2]{y} + \pdv[2]{z}\right)
	}{
		\pdv[2]{#1}{x} + \pdv[2]{#1}{y} + \pdv[2]{#1}{z}
	}
}
% \newcommand{\vlap}{\mqty(\pdv[2]{x}\\\pdv[2]{y}\\\pdv[2]{z})}
% \newcommand{\Vlap}{\mqty(\DS\pdv[2]{x}\\[1em]\DS\pdv[2]{y}\\[1em]\DS\pdv[2]{z})}

% Same for chemistry: \ch{H2O} works nice
% Weird error of inputs limit on pgfmathfunction.code.tex…
% \RequirePackage{chemmacros}
% \chemsetup{modules=base, errorcheck, chemformula, charges, phases}
% \chemsetup[phases]{pos=sub}
\RequirePackage{chemfig}
\definesubmol{&0}{-[0,,,,draw=none]}
\definesubmol{&1}{-[1,,,,draw=none]}
\definesubmol{&2}{-[2,,,,draw=none]}
\definesubmol{&3}{-[3,,,,draw=none]}
\definesubmol{&4}{-[4,,,,draw=none]}
\definesubmol{&5}{-[5,,,,draw=none]}
\definesubmol{&6}{-[6,,,,draw=none]}
\definesubmol{&7}{-[7,,,,draw=none]}
\RequirePackage[version=4]{mhchem}
\RequirePackage{elements}

% For cases quantiques
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
\newcommand{\casea}[1]{
	\begin{tabular}{|P{8pt}|}\hline
		\leftskip=-2pt$#1$
		\\\hline
	\end{tabular}
}
\newcommand{\casec}[3]{
	\begin{tabular}{|P{8pt}|P{8pt}|P{8pt}|}\hline
		\leftskip=-2pt$#1$ & \leftskip=-2pt$#2$ & \leftskip=-2pt$#3$
		\\\hline
	\end{tabular}
}

% Pour \Aboxed dans un environnement align
\RequirePackage{mathtools}
\newtagform{black}{\color{black}(}{)}
% Overbrace and brackets same height with phantom of big fraction
% https://tex.stackexchange.com/a/119998/284518
\newcommand{\xunderbrace}[2][\vphantom{\dfrac{A}{A}}]{\underbrace{#1#2}}
\newcommand{\xunderbracket}[2][\vphantom{\dfrac{A}{A}}]{\underbracket[1pt]{#1#2}}
\newcommand{\xoverbrace}[2][\vphantom{\dfrac{A}{A}}]{\overbrace{#1#2}}
\newcommand{\xoverbracket}[2][\vphantom{\dfrac{A}{A}}]{\overbracket[1pt]{#1#2}}
% To pagebreak equations
\allowdisplaybreaks
% Pour empheq, qui pourrait remplacer à la fois équations et align
\RequirePackage{empheq}
% for \counterwithin
\RequirePackage{chngcntr}

% Pour \endnote
\RequirePackage{endnotes}
%% make it prettier
\renewcommand*{\notesname}{\hspace{-1.1cm} Notes}
\makeatletter
\renewcommand*{\enoteheading}{%
	\section*{\notesname}%
	\markboth{\notesname}{\notesname}}
\makeatother
\renewcommand{\enotesize}{\normalsize}
\renewcommand{\makeenmark}{\textcolor{magenta}{\hbox{$^{\theenmark}$}}}
\renewcommand\enoteformat{%
	\raggedright
	\leftskip=1.8em
	\makebox[0pt][r]{\textcolor{magenta}{\theenmark}~\rule{0pt}{\dimexpr\ht\strutbox+\baselineskip}}%
}
% Make it clickable?
\RequirePackage{hyperendnotes}
% Toggle switch in order to turn on/off back-links in the
% endnote-section:
% \enotelinkstrue
% \enotelinksfalse

% Idk really: endnotes~?
% \makeatletter
% \newcommand*{\toccontents}{\@starttoc{toc}}
% \def\enoteheading{\section*{\notesname
% 	  \@mkboth{\MakeUppercase{\notesname}}{\MakeUppercase{\notesname}}}%
% 	\mbox{}\par\vskip-2.3\baselineskip\noindent\rule{.5\textwidth}{0.4pt}
% 	\par\vskip\baselineskip}
% \makeatother

% Read linux paths
\ExplSyntaxOn
\NewDocumentCommand{\getenv}{om}
{
	\sys_get_shell:nnN { kpsewhich ~ --var-value ~ #2 }
	{ \cctab_select:N \c_str_cctab } \l_tmpa_tl
	\tl_trim_spaces:N \l_tmpa_tl
	\IfNoValueTF { #1 }
	{ \tl_use:N \l_tmpa_tl }
	{ \tl_set_eq:NN #1 \l_tmpa_tl }
}
\ExplSyntaxOff

% set \PREPA
\getenv[\PREPA]{PREPA}

\newcommand{\dodd}{\PREPA/2022/}
\newcommand{\dodt}{\PREPA/2023/}

% Figures
\RequirePackage{graphicx}%[pdftex]{graphicx}
\graphicspath{{./figures/}}
\RequirePackage{svg}
\RequirePackage[noframe]{draftfigure}
% watermark on prof figs
% https://tex.stackexchange.com/a/82345
\RequirePackage{transparent}
% \newcommand{\confidential}{\color{red!10}\transparent{0.5}\LARGE\bfseries PROF}
% \newsavebox\IBox
% \let\IncludeGraphics\includegraphics
% \RenewDocumentCommand{\includegraphics}{s O{} m}{%
%   \sbox\IBox{\IncludeGraphics[#2]{#3}}%
%   \ooalign{\usebox\IBox%
%     \IfBooleanTF{#1}{%
%       \cr\hss%
%       \raisebox{.1\ht\IBox}{\resizebox{.8\wd\IBox}{.8\ht\IBox}{\confidential}}
%       \hss%
%     }{%
%     }
%   }
% }%
% https://tex.stackexchange.com/a/574858
% \newsavebox{\confbox}
% \savebox{\confbox}{\color{red!10}\huge Prof}% create image for overlay
% \newenvironment{conf}{%
%   \begin{lrbox}{0}%
%   \minipage[b]{\linewidth}%
%   }{%
%   \endminipage%
%   \end{lrbox}%
%   \leavemode%
%   \rlap{\resizebox{.15\wd0}{.15\ht0}{\usebox\confbox}}\usebox0
% }
% Figures next to text
\RequirePackage{wrapfig}
% Caption right of figure
\RequirePackage[rightcaption]{sidecap}
\sidecaptionvpos{figure}{t}
% General caption
\RequirePackage[labelfont=bf, font=small]{caption}
\captionsetup{hypcap=false}
\captionsetup[table]{name=Tableau}
% For subfigures
\RequirePackage{subcaption}
% Useful to center wide tables or figures
\makeatletter
\newcommand*{\centerfloat}{%
	\parindent \z@
	\leftskip \z@ \@plus 1fil \@minus \textwidth
	\rightskip\leftskip
	\parfillskip \z@skip}
\makeatother
% center graphics inline
% $\vcenter{\hbox{\includegraphics{temp.jpg}}}$

% Nice chapter
\RequirePackage{titlesec}
% Put numbers in Roman
% \renewcommand{\thechapter}{\Roman{chapter}}
% For TOC with chapter numbers right-aligned, fixing the spilling of VII on text
\RequirePackage[rightlabels]{titletoc}
% Make chapter with frame
\makeatletter
\titleformat{\chapter}[frame]
{\normalfont\setlength{\fboxrule}{1pt}}
{\filright\enspace \@chapapp~\thechapter\enspace}
{8pt}{\LARGE\bfseries\filcenter}
\titlespacing*{\chapter}
{0pt}{0pt}{20pt}
\makeatother

% For centered and hrule before and after text
\newcommand*\headline[1]{%
	\par\noindent\raisebox{.8ex}{%
		\makebox[1\linewidth]{%
			\hrulefill%
			\hspace{1ex}%
			\raisebox{-.8ex}{\Large\bfseries#1}
			\hspace{.15ex}%
			\hrulefill%
		}
	}
}
\newcommand*\tailline[1]{%
	\par\noindent\raisebox{.8ex}{%
		\makebox[1\linewidth]{%
			\hrulefill%
			\hspace{1ex}%
			\raisebox{-1.25ex}{$\scaleto{#1}{10pt}$}
			\hspace{.15ex}%
			\hrulefill%
		}
	}
}
% Make it an environment
\newenvironment{prgm}{
	\headline{Au programme}
	\vspace*{-20pt}%
}
{
	\tailline{\diamond}
}

\renewcommand{\thesection}{\Roman{section}}
\renewcommand{\thesubsection}{\Alph{subsection}}
\renewcommand{\thesubsubsection}{\Roman{section}.\Alph{subsection}.\arabic{subsubsection}}

\titleformat{\section}{\Large\bfseries}{
	\begin{tikzpicture}[scale=0.55, overlay]
		\draw[line width=1pt, color=darkgray, xshift=1em, yshift=0.6em]
		(1,-0.4) -- (1,0.8) --(0.8,1) -- (-0.8,1) -- (-1,0.8) -- (-1,-0.8) --
		(-0.8,-1) -- (32,-1);
		\node[xshift=0.6em, yshift=0.35em] at (0,0)
		{\rmfamily\textcolor{darkgray}{\thesection}};
	\end{tikzpicture}}{0.4em}{\hspace{1.4em}}

\titleformat{\subsection}{\large\bfseries}{\hspace{1cm}
	\tcbox[colback=darkgray, colframe=darkgray,
		coltext=lightgray, on line, boxsep=0pt,
		left=4pt, right=4pt, top=4pt,bottom=4pt,
		sharp corners=northwest]{\thesubsection}}{0.5em}{}

\titleformat{\subsubsection}{\normalsize}{\hspace{2cm}
	\tcbox[colback=white, colframe=darkgray,
		coltext=black, on line, boxsep=0pt,
		left=4pt, right=4pt, top=4pt,bottom=4pt,
		sharp corners=northwest]{\normalsize\thesubsubsection}
	\normalsize}{0.5em}{}

\NewDocumentCommand{\exercice}{om}{
	\renewcommand{\thesection}{E\arabic{section}}
	\titleformat{\section}{\Large\bfseries}{
		\IfNoValueTF{#1}{}{\rpts{#1}}
		\begin{tikzpicture}[scale=0.55, overlay]
			\draw[line width=1pt, color=darkgray, xshift=1em, yshift=0.6em]
			(1,-0.4) -- (1,0.8) --(0.8,1) --
			(-0.8,1) -- (-1,0.8) -- (-1,-0.8) --
			(-0.8,-1) -- (32,-1);
			\node[xshift=0.6em, yshift=0.35em] at (0,0)
			{\rmfamily\textcolor{darkgray}{\thesection}};
		\end{tikzpicture}
	}{0.4em}{\hspace{1.4em}}
	\section{#2}
}
\NewDocumentCommand{\prblm}{om}{
	\renewcommand{\thesection}{P\arabic{section}}
	\titleformat{\section}{\Large\bfseries}{
		\IfNoValueTF{#1}{}{\rpts{#1}}
		\begin{tikzpicture}[scale=0.55, overlay]
			\draw[line width=1pt, color=darkgray, xshift=1em, yshift=0.6em]
			(1,-0.4) -- (1,0.8) --(0.8,1) --
			(-0.8,1) -- (-1,0.8) -- (-1,-0.8) --
			(-0.8,-1) -- (32,-1);
			\node[xshift=0.6em, yshift=0.35em] at (0,0)
			{\rmfamily\textcolor{darkgray}{\thesection}};
		\end{tikzpicture}
	}{0.4em}{\hspace{1.4em}}
	\section{#2}
}

% Nice epigraph
\RequirePackage{epigraph}
\setlength\epigraphwidth{.5\textwidth}
\newenvironment{myepistyle}{\hspace{-7.8pt}}{}
\renewcommand{\textflush}{myepistyle}
% Pour local TOC
\RequirePackage{minitoc}
\renewcommand{\mtctitle}{Sommaire}
\renewcommand{\mlttitle}{Tableaux}
% Pour glossaire
% \RequirePackage{glossaries-extra}

%\RequirePackage{xurl}
%\PassOptionsToPackage{hyphens}{url} % For hyphens in too long urls
\RequirePackage[pdftex,
	pdftitle={Cours de Physique-Chimie de la MPSI 3 du Lyc\'ee Pothier},
	pdfauthor={Nora NICOLAS},
	pdfsubject={Ressources de cours pour l'ann\'ee},
	pdfkeywords={physique, chimie, optique, m\'ecanique, m\'ethode, analyse,
			r\'eflexion},
	breaklinks=true,        % For urls too long
	linktoc=page,           % Titre pas clicable mais page si
	backref=page,           % Add link to go back to section
	colorlinks=true,        % false: boxed links; true: colored links
	linkcolor=dgreen,       % color of internal links
	citecolor=magenta,      % color of links to bibliography
	urlcolor=urlcolor,      % color of external links
	pdfencoding=auto,       % http://tex.stackexchange.com/questions/119079
	psdextra=true,          % for '$' in title
	pdfstartview=FitV,      % open fitting view as default
	hyperfootnotes=true,    % Make the footnote marks into hyperlink to text
	hyperindex=true,
	hyperfigures=false]{hyperref}
\def\UrlBreaks{\do\/\do-}
% Add an upward arrow next to backref,
% from https://tex.stackexchange.com/a/173063
\renewcommand\backrefxxx[3]{%
	\hyperlink{page.#1}{$\uparrow$~Page #1}}
% Make ref to multiple sections with \cref: doesn't seem to work...
% \RequirePackage{cleveref}

% Reinitialise footnote number each page
% \RequirePackage[perchapter]{footmisc}
% Allow referencing to prevous footnote even if mark not a number
% https://tex.stackexchange.com/a/35044
\makeatletter
\newcommand\footnoteref[1]{\protected@xdef\@thefnmark{\ref{#1}}\@footnotemark}
\makeatother

% Shorthand for footnotes
\newcommand{\ftn}[1]{%
	\footnote{#1}%
}
\newcommand{\fnt}[1]{%
	\footnotetext{#1}%
}
\newcommand{\fnr}[1]{%
	\footnoteref{#1}%
}
\newcommand{\fnm}{%
	\footnotemark%
}

% Pour les plots
\RequirePackage{pgfplots}
\pgfplotsset{compat=newest}

% Draw nice quotes in TiKz
\RequirePackage{tikz}
\newcommand*{\openquote}{%
	\tikz[remember picture, overlay, xshift=-5pt, yshift=0pt]
	\node[black!30] (OQ) {\fontfamily{qbk}\fontsize{50}{60}\selectfont«};%
	\kern4pt
}
\newcommand*{\closequote}{%
	\tikz[remember picture, overlay, xshift=10pt, yshift=0pt]
	\node[black!30] (CQ) {\fontfamily{qbk}\fontsize{50}{60}\selectfont»};%
}
\usetikzlibrary{trees, positioning, arrows, tikzmark, calc, mindmap}
% Circled numbers
% https://tex.stackexchange.com/a/7045
\newcommand*\circled[1]{%
	\tikz[baseline=(char.base)]{%
		\node[shape=circle, draw, inner sep=1pt] (char) {#1};
	}%
}
\newcommand*\icircled[1]{%
	\tikz[baseline=(char.base)]{%
		\node[shape=circle, draw, inner sep=1pt, minimum size=3ex] (char) {#1};
	}\kern-3pt
}

% For spectra
\RequirePackage{pgf-spectra}

\RequirePackage{microtype}

% Pour des flèches entre les lignes d'un align!!
\RequirePackage{witharrows}
\WithArrowsOptions{displaystyle, tikz={font={\small}}}
% style for calc
\WithArrowsNewStyle{calc}{
	tikz-code={
			\draw[rounded corners, every node/.style={circle,
						draw,
						auto=false,
						inner sep=1pt,
						fill=gray!50,
						font=\tiny}
			]
			let \p1 = (##1),
			\p2 = (##2)
			in \ifdim \x1 > \x2
				(\p1) -- node {##3} (\x1,\y2) -- (\p2)
			\else
				(\p1) -- (\x2,\y1) -- node {##3} (\p2)
			\fi ;
		}
}
% calc arrow
\newcommand{\CArrow}{
	\Arrow[
		tikz={
				every node/.style={
						circle,
						draw,
						auto=false,
						fill=white,
						inner sep=1pt,
						font=\tiny
					}
			}
	]
}
% Math symbols
\RequirePackage{amsmath, amssymb} % , amsthm}
\DeclareMathOperator{\acosh}{argch}
\DeclareMathOperator{\asinh}{argsh}
\let\cosh\relax
\DeclareMathOperator{\cosh}{ch}
\let\sinh\relax
\DeclareMathOperator{\sinh}{sh}
% To manually put \blacksquare flushedright of align* environnement
% https://tex.stackexchange.com/a/144984/284518
\newcommand{\qed}{\tag*{$\blacksquare$}}
\newcommand{\qef}{\tag*{$\square$}}
\newcommand{\hqed}{\hfill{$\blacksquare$}}
\newcommand{\hqef}{\hfill{$\square$}}
\RequirePackage{textcomp}
\RequirePackage{eurosym}
% For integrals
\RequirePackage{esint}
% for some commands like \degree, \celsius, \micro in both text and maths mode
\RequirePackage{gensymb}

% Resume enumerate and set list
\RequirePackage{enumitem}
% horizontal lists
\RequirePackage{tasks}

% Pretty tables
\RequirePackage{booktabs}
% Title, table and notes
\RequirePackage{threeparttable}
% redefine the minimum amount of space that is used by the caption and the notes
% https://tex.stackexchange.com/a/355973
\renewcommand{\TPTminimum}{\linewidth}
% Set caption of notes to \small
% \appto\TPTnoteSettings{\small}
% Self-explanatory
\RequirePackage{multirow}
% Pour écrire côte à côte dans les tcolorboxes
\RequirePackage{multicol}
\setlength\columnseprule{.4pt}
% Other tables
\RequirePackage{tabularx}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcolumntype{M}{>{\centering\arraybackslash}m}
\renewcommand\tabularxcolumn[1]{>{\vspace{\fill}}m{#1}<{\vspace{\fill}}}
% For \vline in tabav. Thanks Bruno PAGANI.
\newcolumntype{d}{@{}c@{}}
% \renewcommand\tabularxcolumn[1]{m{#1}}
% Multicolumn with X column spanning entire row
% https://tex.stackexchange.com/a/544644/284518 in the comments
\newcommand{\mcl}[4]{\multicolumn{#1}{#2>{
\hsize=\dimexpr#1\hsize+\tabcolsep*(2*(#1-1))+\arrayrulewidth*(#1-2)\relax
}#3}{#4}}
% For arrays
\arraycolsep=1.4pt
% For vertical space centered
% https://tex.stackexchange.com/a/394777/284518
% \RequirePackage{makecell}

% For dashed lines in tables
\RequirePackage{arydshln}
% Dashrule
\RequirePackage{dashrule}
% Rotate elements, and hence big tables
%\RequirePackage[graphicx]{realboxes}
\RequirePackage{rotating}
% Emojis
\RequirePackage{twemojis}

% Pretty units
\RequirePackage{siunitx}[=v2]
\NewCommandCopy\mycdot\cdot
\sisetup{%
	detect-all,
	free-standing-units,           % create standalone commands
	locale=FR,                     % language
	inter-unit-product=
		{\ensuremath{\!\mycdot\!}},  % character between units
	separate-uncertainty,          % x ± dx
	retain-explicit-plus,          % p.ex. +45°
	range-units=brackets,          % (0 to 40) m
	range-phrase=~;,               % 0~;~40 m
	% range-phrase=\textup{--},    % 0--40 m
	% open-bracket= [,
	% close-bracket= ],
	% angle-symbol-over-decimal,   % p.ex. 0.''11
}
\def\Lsun{L\ensuremath{_{\odot}}}
\def\Rsun{R\ensuremath{_{\odot}}}
\def\Tsun{T\ensuremath{_{\odot}}}
\def\Msun{M\ensuremath{_{\odot}}}
\def\Rearth{R\ensuremath{_{\oplus}}}
\def\Mearth{M\ensuremath{_{\oplus}}}
\def\Tearth{T\ensuremath{_{\oplus}}}
\DeclareSIUnit\pc{pc}           % parsec
\DeclareSIUnit\as{as}           % arcsec
\DeclareSIUnit\mag{mag}         % mag
\DeclareSIUnit{\angstrom}{\textup{\AA}}
\DeclareSIUnit{\EUR}{\text{\euro}}
% Tabular sinuit~: S[table-format=1.2e-2]
% Sitime, https://tex.stackexchange.com/a/511875/284518
% Doesn't work, invalid token in number
\makeatletter
\newcommand{\sitime}[1]{\sitime@aux#1;;;\@nil}
\def\sitime@aux#1;#2;#3;#4\@nil{%
	\@ifmtarg{#1#2#3}%
	{%
		\PackageError{siunitx (modified)}%
		{Empty \string\sitime\space argument}{}%
	}%
	{%
		\@ifmtarg{#1}{}{\SI{#1}{\hour}\@ifmtarg{#2#3}{}{\csname l_siunitx_number_unit_separator_tl\endcsname}}%
		\@ifmtarg{#2}{}{~ \SI{#2}{\minute}\@ifmtarg{#3}{}{\csname l_siunitx_number_unit_separator_tl\endcsname}}%
		\@ifmtarg{#3}{}{~\SI{#3}{\second}}%
	}%
}
\makeatother
% Silence warning message that `physics` and `siunitx` define \qty
\ExplSyntaxOn
\msg_redirect_name:nnn { siunitx } { physics-pkg } { none }
\ExplSyntaxOff

% Math in section names
\RequirePackage{bookmark} % http://tex.stackexchange.com/questions/119079

% Include code, but there might be a better package
% Try \RequirePackage{pythonhighlight}
% https://github.com/olivierverdier/python-latex-highlighting
\RequirePackage{listingsutf8}
\RequirePackage{fix-cm}
\lstset{inputencoding=utf8/latin1}
\definecolor{fond}{gray}{0.95}
\lstnewenvironment{python}{
\lstset{language     = python,
% basicstyle       = \ttfamily,
keywordstyle     = \bfseries\ttfamily\color{green!40!black},
commentstyle     = \itshape\color{purple!40!black},
identifierstyle  = \color{black},
stringstyle      = \color{black},
backgroundcolor  = \color{fond},
numbers          = none,
frame            = leftline,
framerule        = 3pt,
rulecolor        = \color{gray},
showstringspaces = false
extendedchars    = true,
literate         = {á}{{\'a}}1
{à}{{\`a}}1
{À}{{\`A}}1
{ã}{{\~a}}1
{é}{{\'e}}1
{É}{{\'E}}1
{è}{{\`e}}1
{ê}{{\^e}}1
{ç}{{\c{c}}}1
,
}}{}

% For 80 columns automatically
% https://tex.stackexchange.com/a/142409
\newlength{\eightytt}
\newcommand{\testthewidth}{%
	\fontsize{\dimen0}{0}\selectfont
	\sbox0{x\global\dimen1=0.6em}%
	\ifdim 80\dimen1>\textwidth
		\advance\dimen0 by -.1pt
		\expandafter\testthewidth
	\else
		\global\eightytt\dimen0
	\fi
}
\AtBeginDocument{%
	\dimen0=\csname f@size\endcsname pt
	\begingroup
	\ttfamily
	\testthewidth
	\endgroup
	\lstset{
		basicstyle=\fontsize{\eightytt}{1.2\eightytt}\ttfamily
	}%
}

% Include verbatim in text
\RequirePackage{fancyvrb}
% To customize it see for instance https://tex.stackexchange.com/a/85218

% Profondeur des sections dans la table of contents
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{4}

% Définition des puces des listes
%\setlist{nosep} % Interligne nul
\setlist{itemsep=3pt} % Interligne nul
\setlist[enumerate,1]{leftmargin=10pt, label=\arabic*)}
\setlist[enumerate,2]{leftmargin=20pt, label=\alph* --}
\setlist[enumerate,3]{leftmargin=30pt, label=\roman*.}
% \setlist[itemize,1]{leftmargin=10pt}
% \setlist[itemize,2]{leftmargin=20pt}
\setlist[itemize,1]{label=$\diamond$, leftmargin=10pt}
\setlist[itemize,2]{label=$\triangleright$, leftmargin=20pt}
\setlist[itemize,3]{leftmargin=30pt}

% Setup special items
\newif\iffitem
	\newcommand{\setupmodenumerate}{%
	\global\fitemfalse
	\let\origmakelabel\makelabel
	\def\fitem##1{\global\fitemtrue\def\toapply{##1}\item}%
	\def\makelabel##1{%
\origmakelabel{%
	\iffitem{%
		\renewcommand{\labelenumi}{\arabic{enumi}}%
		\renewcommand{\labelenumii}{\alph{enumii}}%
		\renewcommand{\labelenumiii}{\roman{enumiii}}%
		\toapply{##1}%
	}%
\else##1\fi}%
\global\fitemfalse
}%
}
\setlist[enumerate]{before=\setupmodenumerate}
% Number in squares
\newcommand{\sqenumi}{\protect\fbox{\arabic*}}
\newcommand{\sqitem}{\fitem{\fbox}}
% Number in circles
\newcommand{\clenumi}{\protect\icircled{\arabic*}}
\newcommand{\clitem}{\fitem{\icircled}}
% Description with numbers
\newcommand\bitem[1]{\item{\bfseries #1}}
% Setup points left of enumerate
\RequirePackage{tabto}
\newcommand\gpts[1]{\tabto*{-2\leftmargin}\textcolor{ForestGreen}{\llap{/#1~}\tabto{\TabPrevPos}}}
\newcommand\rpts[1]{\tabto*{-2.5\leftmargin}\textcolor{Red}{\llap{/#1~}\tabto{\TabPrevPos}}}
\newcommand{\nitem}[1]{\item\gpts{#1}\/}
% mathitem to remove space when only equation in item
% https://tex.stackexchange.com/a/497787
\newcommand\mnitem[1]{\item\gpts{#1}\leavevmode\vspace*{-\dimexpr\baselineskip+\abovedisplayskip\relax}}
\newcommand\mitem{\item\leavevmode\vspace*{-\dimexpr\baselineskip+\abovedisplayskip\relax}}

% Bolditemize
% https://tex.stackexchange.com/a/266229
\newenvironment{bolditemize}{\begin{itemize} }{\end{itemize}}
\expandafter\def\expandafter\bolditemize\expandafter{%
	\bolditemize \let\olditem\item \def\item[##1]{\olditem \textbf{##1}}}

\newcommand{\ed}[2]{#1\endnote{\textcolor{black}{#1} : #2}}
\newcommand{\obar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}
\newcommand{\opto}[2]{\xrightarrow[#2]{#1}}
\newcommand{\prob}[2]{\mathcal{P}\left(#1 \mid #2\right)}
\newcommand{\moy}[1]{\left\langle #1 \right\rangle}

% Environnements de mises en valeur
\RequirePackage[many]{tcolorbox}
\tcbuselibrary{skins, raster, xparse}

% Useful tools
\RequirePackage{etoolbox}
\RequirePackage{xstring}
\RequirePackage{footnote}
% Footnotes outside tcboxes
\BeforeBeginEnvironment{tcolorbox}{\savenotes}
\AfterEndEnvironment{tcolorbox}{\spewnotes}
\BeforeBeginEnvironment{tcb}{\savenotes}
\AfterEndEnvironment{tcb}{\spewnotes}
\BeforeBeginEnvironment{tcb*}{\savenotes}
\AfterEndEnvironment{tcb*}{\spewnotes}
\BeforeBeginEnvironment{minipage}{\savenotes}
\AfterEndEnvironment{minipage}{\spewnotes}

% New commands for pretty formatting (TP)
\newlength{\leftlength}
\newlength{\rightlength}

\newcommand{\leftcentersright}[3]{
	\medskip
	\settowidth{\leftlength}{#1}
	\settowidth{\rightlength}{#3}
	\noindent#1\hskip-\leftlength
	\hfill{#2}\hfill
	\mbox{}\hskip-\rightlength#3
	\medskip
}

\newcommand{\centers}[1]{\leftcentersright{}{#1}{}}
\newcommand{\leftcenters}[2]{\leftcentersright{#1}{#2}{}}
\newcommand{\centersright}[2]{\leftcentersright{}{#1}{#2}}
\newcommand{\leftencadreright}[3]{\leftcentersright{#1}{\fbox{#2}}{#3}}
\newcommand{\encadre}[1]{\leftcentersright{}{\fbox{#1}}{}}
\newcommand{\leftencadre}[2]{\leftcentersright{#1}{\fbox{#2}}{}}
\newcommand{\encadreright}[2]{\leftcentersright{}{\fbox{#1}}{#2}}

\newcommand{\encadreminipage}[2]{%
	\leftcentersright{}{\fbox{%
			\begin{minipage}{#1} #2 \end{minipage}%
		}}{}%
}

\newcommand{\centersminipage}[2]{%
	\leftcentersright{}{%
		\begin{minipage}{#1} #2 \end{minipage}%
	}{}%
}

% ??
\newcommand{\Sim}{\ensuremath{\mathop{\sim}\limits}}

% Make toggle for teacher and student version of file
\newtoggle{student}
\togglefalse{student}
\newtoggle{corrige}
\togglefalse{corrige}
\newcommand{\ifstudent}[1]{
	\iftoggle{student}{%
		#1%
	}{}
}
\newcommand{\ifprof}[1]{
	\iftoggle{student}{%
	}{
		#1%
	}
}
\newcommand{\sswitch}[2]{
	\iftoggle{student}{%
		#1%
	}{%
		#2%
	}%
}
\newcommand{\ifcorrige}[1]{
	\iftoggle{corrige}{%
		#1%
	}{}
}
\newcommand{\ifenonce}[1]{
	\iftoggle{enonce}{%
	}{
		#1%
  }
}
\newcommand{\cswitch}[2]{
	\iftoggle{corrige}{%
		#1%
	}{%
		#2%
	}%
}
% Setup color
\newcommand{\mycol}{black}
\newcommand{\csw}[1]{%
	\textcolor{\sswitch{white!10}{\mycol}}{%
		#1%
	}%
}
% Automatic white
\newcommand{\wsw}[1]{%
	\textcolor{\sswitch{white!10}{black!100}}{%
		#1%
	}%
}
% For tablette use
\newcommand{\psw}[1]{%
	\textcolor{\sswitch{white!10}{gray!100}}{%
		#1%
	}%
}
% Command for highlighting switch
\RequirePackage{soul}
\sethlcolor{lightgray}
% \RequirePackage[soul]{lua-ul}
% \RequirePackage{luacolor}
% \newcommand{\hl}[1]{%
%   \highLight{#1}
% }
% \LuaULSetHighLightColor{gray}
\DeclareRobustCommand{\mhl}[1]{%
	\ifmmode\text{\hl{$#1$}}\else\hl{#1}\fi
}
\newcommand{\hsw}[1]{%
	\switch{\textcolor{white!10}{#1}}{\mhl{#1}}
}

% To make `hide` command
% https://tex.stackexchange.com/a/135485/284518
\RequirePackage{varwidth}
\newcommand\hide[1]{\phantom{\varwidth{\linewidth}#1\endvarwidth}}
% \toggletrue{student} will hide the command
\newcommand{\hdsw}[1]{
	\iftoggle{student}{
		#1
	}{
		\hide{#1}
	}
}

% Hide environment
\RequirePackage{comment}
\newif\ifHideSolutions
% Make a solution environment
\generalcomment{hide}{%
	\begingroup
	\ifHideSolutions%
		% if \HideSolutionstrue is not called, then we remove the contents
		\def\ProcessCutFile{}\fi%
}{%
	\ifHideSolutions%
		% aand,now (also when it's not called), we make a box
		% and then we \input the \CommentCutFile.
		\setbox1=\vbox{\input{\CommentCutFile}}%
		% Get the height from \ht1 and use \vskip to make appropriate space
		\vskip\ht1
	\fi
	\endgroup%
}

% Make QR like BPEP
\newlist{blocQR}{enumerate}{2}
\setlist[blocQR,1]{leftmargin=10pt, resume, label=\arabic*)}
\setlist[blocQR,2]{leftmargin=20pt, resume, label=\alph* --}
\newcommand{\resetQ}{\restartlist{blocQR}}

% Cannibalize the rest
% compteur d'exercices
\newcounter{exoIndex}
\setcounter{exoIndex}{0}

\newtoggle{corrigeEtendu}
\toggletrue{corrigeEtendu}

\newtoggle{bareme}
\togglefalse{bareme}

\newtoggle{enonce}
\toggletrue{enonce}

\newtoggle{sujet}
\toggletrue{sujet}

\newcommand{\sujetUniquement}[1]{
  % apparait si sujet == vrai et corrigé == faux
  \iftoggle{sujet}{
    \iftoggle{corrige}{}{
      #1
    }
  }{}
}

\newcommand{\siCorrige}[1]{
  % apparait corrigé == vrai
  \iftoggle{corrige}{
    #1
  }{}
}
\newcommand{\enonce}[2][]{
  \iftoggle{enonce}{
    \showAccordingToVersion[#1]{
      #2
    }
  }{}
}

\newenvironment{answ}{
	\headline{\small Réponse}
}
{
	\tailline{\diamond}
}

\NewDocumentCommand{\QR}{o+m+m}{%
  \iftoggle{bareme}{ % Force l'affichage du bareme quoiqu'il en soit
    \begin{blocQR}
      \iftoggle{student}{ % pour version student
        \iftoggle{corrige}{ % version avec corrigé : affiche juste la correction
          \nitem{#1}#3%
          }{ % version sans corrigé
          \nitem{#1}#2%
          }%
      }{% pour version prof
        \iftoggle{corrige}{% pour version avec corrigé : question ET réponse
          \nitem{#1}#2%
            \begin{answ}%
            #3%
            \end{answ}%
          }{ % version sans corrigé : que la question.
            \item #2%
        }
      }
    \end{blocQR}
  }{
    \IfValueTF{#1}{ % Si [nb], ajoute un nombre de points
      % \iftoggle{bareme}{ % si bareme == true, ajoute les points dans [nb]
      \begin{blocQR}
        \iftoggle{student}{ % pour version student
          \iftoggle{corrige}{ % version avec corrigé : affiche juste la correction
            \nitem{#1}#3%
            }{ % version sans corrigé
            \item #2%
            }%
        }{% pour version prof
          \iftoggle{corrige}{% pour version avec corrigé : question ET réponse
            \nitem{#1}#2%
              \begin{answ}%
              #3%
              \end{answ}%
            }{ % version sans corrigé : que la question.
              \item #2%
          }
        }
      \end{blocQR}
    }{ % Si bareme == false, pas de points
      \begin{blocQR}
        \iftoggle{student}{% pour version student
          \iftoggle{corrige}{% version avec corrigé : affiche juste la correction
            \item #3%
            }{
            \item #2%
            }%
        }{%
          \iftoggle{corrige}{% pour version avec corrigé : question ET réponse
            \item #2%
              \begin{answ}
              #3
              \end{answ}
            }{ % version sans corrigé : que la question.
              \item #2%
          }%
        }%
      \end{blocQR}%
    }
  }
}

% QR of actual BPEP
\newcounter{qrIndex} % compteur pour les questions
\newcounter{qrIndexSaved}
\newcommand{\save}{\setcounter{qrIndexSaved}{\theqrIndex}}
\newcommand{\retrieve}{\setcounter{qrIndex}{\theqrIndexSaved}}
\newcommand{\resetQold}{\setcounter{qrIndex}{1}}
% ajout d'une question
\RequirePackage{twoopt} % permet de mettre 2 options facultatives pour le barème
\newcommandtwoopt{\QRold}[4][][]{ % cette fonction gère l'affichage suivant la version. La modifier est considéré comme dangereux.	
  \showAccordingToVersion[#1]{
    \begin{enumerate}[start=\theqrIndex]
      \stepcounter{qrIndex}
      \item %\qrIndex
            \iftoggle{sujet}{
              \addQq{#3}
            }{}

            \iftoggle{corrige}{
              \addQr{#4}
            }{}

            \iftoggle{bareme}{
              \addQb{#2}{#4}
            }{}
    \end{enumerate}
  }
}

\newcommand{\addQq}[1]{ % la question à afficher en mode corrigé : peut être modifié
  \iftoggle{corrige}{
    #1 % affichage de la question en mode corrigé
  }{
    #1 % affichage hors mode corrigé
  }
}


\newcommand{\addQr}[1]{ % la réponse à afficher en mode corrigé : peut être modifié
  \mbox{}\\	\textbf{Réponse : } \mbox{} \\
  #1
}

\newcommand{\addQb}[2]{
  \noindent
  \begin{minipage}[t]{0.9\linewidth}
  #2
  \end{minipage}\hfill\vrule\hfill
  \begin{minipage}[t]{0.08\linewidth}
  \centering
  #1 pt(s)
  \end{minipage}
  \hrule
}
\newcommand{\version}{original}

% titre exercice
\newcommand{\titreExercice}[1]{
	\stepcounter{exoIndex}
	\section{#1}
}
% titre partie
\newcommand{\partie}[2][]{
  \showAccordingToVersion[#1]{
    \subsection{#2}
  }
}

% titre sous partie
\newcommand{\sousPartie}[2][]{
  \showAccordingToVersion[#1]{
    \subsubsection{#2}
  }
}

\newcommand{\showAccordingToVersion}[2][]{
  \exploregroups
  \ifthenelse{\equal{#1}{}}{
    % sans argument opt, la question est toujours affichée
    #2
  }{
    % si argument opt, on traite au cas par cas
    \IfSubStr{#1 }{\version}{
      % si la liste des tags de version contient la valeur de \version			
      #2
    }{
      % sinon, on affiche rien !			
    }
  }
}

%%%%%%%%%%%%%%%%%
%%%% Astuces %%%%
%%%%%%%%%%%%%%%%%

% gestion des astuces
\newtoggle{astuces}
\togglefalse{astuces}
\newtoggle{astucesPresentes}
\togglefalse{astucesPresentes}

\newsavebox{\hints}
\setbox\hints=\vbox{}

%\newcommand{\hint}[1]{\hintFF{\rotatebox{180}{#1}}}
\newcommand{\astuce}[1]{

	\iftoggle{astuces}{
		\global\toggletrue{astucesPresentes}
		\hintFF{#1}
	}{
	}
}

\AtEndDocument{
	\iftoggle{astucesPresentes}{
		\mbox{} \par \textbf{Astuces : } \\
		\unvbox\hints
	}{}
}

\newcommand{\hintFF}[1]% #1 = paragraph
{\global\setbox\hints=\vbox{\unvbox\hints\strut  E\theexoIndex~Q{\the\numexpr\value{qrIndex}-1} :    #1 \strut}}


\AtVeryEndDocument{
	\label{page:last}
}

%%%%%%%%%%%%%%%%%
%%%% Figures %%%%
%%%%%%%%%%%%%%%%%

% utile pour les figures qui ne doivent pas être redimensionnées
\newcommand{\figRaw}[2][]{ % possibilité d'ajouter des arguments optionnels dans includeGraphics en plus
	\begin{center}
		\includegraphics[#1]{images/#2}
	\end{center}
}


\newcommand{\fig}[3][]{ % possibilité d'ajouter des arguments optionnels en plus
	\begin{center}
		\includegraphics[width=#2\linewidth, #1]{images/#3}
	\end{center}
}

% figure avec caption

\newcommand{\figCap}[4][]{
	\begin{center}
		\includegraphics[width=#2\linewidth, #1]{images/#3}
	\end{center}
	\vspace{-4mm}
	\captionof{figure}{#4}
	\bigskip
}

\newcommand{\figCapRaw}[3][]{
	\begin{center}
		\includegraphics[#1]{images/#2}
	\end{center}
	\vspace{-4mm}
	\captionof{figure}{#3}
	\bigskip
}
% Boxes types: colors
\colorlet{loi}{red!60!black}
\colorlet{theo}{red!70!black}
\colorlet{ques}{red!80!black}
\colorlet{prop}{red!80!black}
\colorlet{demo}{blue!80!black}
\colorlet{coro}{VioletRed!60!black}
\colorlet{inte}{RoyalBlue!50!black}
\colorlet{impl}{DodgerBlue!50!black}
\colorlet{impo}{BlueViolet!70!black}
\colorlet{tool}{BlueViolet!80!black}
\colorlet{rapp}{BlueViolet!60!black}
\colorlet{defi}{green!60!black}
\colorlet{data}{green!60!black}
\colorlet{nota}{green!50!black}
\colorlet{ror}{orange!90!black}
\colorlet{exem}{lightgray!55!black}
\colorlet{expe}{lightgray!55!black}
\colorlet{mate}{lightgray!55!black}
\colorlet{odgr}{lightgray!50!black}
\colorlet{appl}{gray!50!black}
\colorlet{rema}{darkgray!50!black}
\colorlet{black}{black}
% for backs in fill style
\colorlet{loiback}{red!10}
\colorlet{theoback}{red!10}
\colorlet{quesback}{red!10}
\colorlet{propback}{red!10}
\colorlet{demoback}{blue!10}
\colorlet{coroback}{VioletRed!10}
\colorlet{inteback}{RoyalBlue!10}
\colorlet{implback}{DodgerBlue!10}
\colorlet{impoback}{BlueViolet!10}
\colorlet{toolback}{BlueViolet!10}
\colorlet{rappback}{BlueViolet!10}
\colorlet{defiback}{green!10}
\colorlet{toolback}{green!10}
\colorlet{notaback}{green!10}
\colorlet{rorback}{orange!10}
\colorlet{exemback}{lightgray!10}
\colorlet{expeback}{lightgray!10}
\colorlet{mateback}{lightgray!10}
\colorlet{odgrback}{lightgray!10}
\colorlet{applback}{gray!10}
\colorlet{remaback}{darkgray!10}
\colorlet{blackback}{white}
% set names for counters
\newcommand{\nameloi}{Loi}
\newcommand{\nametheo}{Théorème}
\newcommand{\nameques}{Question}
\newcommand{\nameprop}{Propriété}
\newcommand{\namedemo}{Démonstration}
\newcommand{\namecoro}{Corollaire}
\newcommand{\nameinte}{Interprétation}
\newcommand{\nameimpl}{Implication}
\newcommand{\nameimpo}{Important}
\newcommand{\nametool}{Outils}
\newcommand{\namerapp}{Rappel}
\newcommand{\namedefi}{Définition}
\newcommand{\namedata}{Données}
\newcommand{\namenota}{Notation}
\newcommand{\nameror}{Important}
\newcommand{\nameexem}{Exemple}
\newcommand{\nameexpe}{Manipulation}
\newcommand{\namemate}{Matériel}
\newcommand{\nameodgr}{Ordre de grandeur}
\newcommand{\nameappl}{Application}
\newcommand{\namerema}{Remarque}
% set counters
\newcounter{loi}[chapter]
\renewcommand{\theloi}{\thechapter.\arabic{loi}}
\newcounter{theo}[chapter]
\renewcommand{\thetheo}{\thechapter.\arabic{theo}}
\newcounter{ques}[chapter]
\renewcommand{\theques}{\thechapter.\arabic{ques}}
\newcounter{prop}[chapter]
\renewcommand{\theprop}{\thechapter.\arabic{prop}}
\newcounter{demo}[chapter]
\renewcommand{\thedemo}{\thechapter.\arabic{demo}}
\newcounter{coro}[chapter]
\renewcommand{\thecoro}{\thechapter.\arabic{coro}}
\newcounter{inte}[chapter]
\renewcommand{\theinte}{\thechapter.\arabic{inte}}
\newcounter{impl}[chapter]
\renewcommand{\theimpl}{\thechapter.\arabic{impl}}
\newcounter{impo}[chapter]
\renewcommand{\theimpo}{\thechapter.\arabic{impo}}
\newcounter{tool}[chapter]
\renewcommand{\thetool}{\thechapter.\arabic{tool}}
\newcounter{rapp}[chapter]
\renewcommand{\therapp}{\thechapter.\arabic{rapp}}
\newcounter{defi}[chapter]
\renewcommand{\thedefi}{\thechapter.\arabic{defi}}
\newcounter{data}[chapter]
\renewcommand{\thedata}{\thechapter.\arabic{data}}
\newcounter{nota}[chapter]
\renewcommand{\thenota}{\thechapter.\arabic{nota}}
\newcounter{ror}[chapter]
\renewcommand{\theror}{\thechapter.\arabic{ror}}
\newcounter{exem}[chapter]
\renewcommand{\theexem}{\thechapter.\arabic{exem}}
\newcounter{expe}[chapter]
\renewcommand{\theexpe}{\thechapter.\arabic{expe}}
\newcounter{mate}[chapter]
\renewcommand{\themate}{\thechapter.\arabic{mate}}
\newcounter{odgr}[chapter]
\renewcommand{\theodgr}{\thechapter.\arabic{odgr}}
\newcounter{appl}[chapter]
\renewcommand{\theappl}{\thechapter.\arabic{appl}}
\newcounter{rema}[chapter]
\renewcommand{\therema}{\thechapter.\arabic{rema}}
\newcounter{null}[chapter]
\renewcommand{\thenull}{\thechapter.\arabic{null}}
% For icons
\usepackage{fontawesome5}
\tcbset{
	licon/.style={
			overlay unbroken and first={
					\node[anchor=center, scale=2]
					at ([shift={(-0.7,-0.4)}]frame.north west)
					{\csname icon#1\endcsname};
				}
		}
}
\tcbset{
	ricon/.style={
			overlay unbroken and first={
					\node[anchor=center, scale=2]
					at ([shift={(+0.7,-0.4)}]frame.north east)
					{\csname icon#1\endcsname};
				}
		}
}
\newcommand{\iconloi}{\faIcon{drafting-compass}}
\newcommand{\icontheo}{\faIcon{drafting-compass}}
\newcommand{\iconques}{\faIcon{question}}
\newcommand{\iconprop}{\faIcon{drafting-compass}}
\newcommand{\icondemo}{\faIcon{list-ul}}
\newcommand{\iconcoro}{\faIcon{code-branch}}
\newcommand{\iconinte}{\faIcon{angle-right}}
\newcommand{\iconimpl}{\faIcon{angle-double-right}}
\newcommand{\iconlimp}{\faIcon{angle-double-left}}
\newcommand{\iconimpo}{\faIcon{exclamation-triangle}}
\newcommand{\icontool}{\faIcon{wrench}}
\newcommand{\iconrapp}{\faIcon[regular]{bookmark}}
\newcommand{\icondefi}{\faIcon{book}}
\newcommand{\icondata}{\faIcon{database}}
\newcommand{\iconnota}{\faIcon{pencil-alt}}
\newcommand{\iconror}{\includegraphics[scale=.15]{\PREPA/figures_generales/heart.jpg}}
\newcommand{\icontrans}{
\includegraphics[angle=-90, origin=c, height=0.5cm]{\PREPA/figures_generales/pr.jpg}
}
\newcommand{\iconexem}{\faIcon{external-link-alt}}
\newcommand{\iconodgr}{\faIcon{calculator}}
\newcommand{\iconappl}{\faIcon{edit}}
\newcommand{\iconrema}{\faIcon[regular]{hand-point-right}}
\newcommand{\iconlrem}{\faIcon[regular]{hand-point-left}}
%
\newcommand{\icondown}{\faIcon[regular]{hand-point-down}}
\newcommand{\iconknow}{\faIcon{brain}}
\newcommand{\iconhow}{\faIcon{pencil-ruler}}
\newcommand{\iconmate}{\faIcon{flask}}
\newcommand{\iconexpe}{\faIcon{cogs}}
\newcommand{\iconwip}{\faIcon{hard-hat}}
\newcommand{\iconbomb}{\faIcon{bomb}}
% \newcommand{\iconexpe}{\faIcon{fill}}
\newcommand{\iconbulb}{\faIcon[regular]{lightbulb}}
\newcommand{\iconinfo}{\faIcon{info-circle}}
\newcommand{\iconkeyb}{\faIcon{keyboard}}
\newcommand{\iconwron}{\faIcon{times-circle}}
\newcommand{\icondivi}{\faIcon{divide}}
\newcommand{\iconleft}{\faIcon{angle-left}}
\newcommand{\iconrigt}{\faIcon{angle-right}}

% My generic box name
% based on the great answer https://tex.stackexchange.com/a/471615/284518
\NewTColorBox{tcb}{sO{}r()D<>{box}d""D''{l}m}{%
base,
#6icon=\IfBooleanTF{#1}{#5}{#3},
#4={#3}{#7},
#2,
}
% with numbers
\NewTColorBox{tcb*}{sO{}r()D<>{box}d""D''{l}m}{%
base,
#6icon=\IfBooleanTF{#1}{#5}{#3},
#4={#3}{\csname name#3\endcsname~\expandafter\csname the#3\endcsname~:~#7},
step={#3},
#2,
}

% Basic styles of boxes
% thanks to https://tex.stackexchange.com/a/252907/284518 for 2 args
\tcbset{
	base/.style={
			enhanced, sharp corners=uphill, valign=center,
			subtitle style={
					enhanced,
					frame hidden,
					interior hidden,
					halign=center,
				}
		}
}
% Simple box
\tcbset{
	box/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
			borderline={1pt}{0pt}{#1}, coltitle=#1,
			fonttitle=\bfseries, top=10pt,
			attach boxed title to top left={yshift={-9pt}, xshift=10pt},
			boxed title style={enhanced, frame hidden, colback=white},
			title={#2},
		}
}
% Only left
\tcbset{
	lft/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
			borderline west={1pt}{0pt}{#1},
			overlay unbroken and first={%
					\node[rotate=90,
						minimum width=1cm,
						anchor=south,
						font=\bfseries,
						color=#1]
					at (frame.west) {#2};
				}
		}
}
\tcbset{
	lfnt/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
			borderline west={1pt}{0pt}{#1},
		}
}
% Only right
\tcbset{
	rgt/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
			borderline east={1pt}{0pt}{#1},
			overlay unbroken and first ={%
					\node[rotate=90,
						minimum width=1cm,
						anchor=south,
						font=\bfseries,
						color=#1]
					at ([shift={(16pt,0)}]frame.east) {#2};
				}
		}
}
\tcbset{
	rgnt/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
			borderline east={1pt}{0pt}{#1},
		}
}
% Empty
\tcbset{
	non/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
		}
}
% Old box style
\tcbset{
	fil/.style 2 args={
			fonttitle=\bfseries,
			colback=#1back,
			colframe=#1,
			title={#2},
		}
}
% Instruction
\tcbset{
	itc/.style 2 args={
			fonttitle=\bfseries,
			attach boxed title to top center={yshift=-2mm},
			colback=#1back,
			colframe={#1},
			title={#2},
		}
}
% Flip 180
\tcbset{
	aide/.style={
			tikz={rotate=180, transform shape}
		}
}
% Center all
\tcbset{
	cnt/.style={
			halign=center,
			halign lower=center
		}
}
% Bold all
\tcbset{
	bld/.style={
			fontupper=\bfseries,
			fontlower=\bfseries
		}
}
% For side inside box
\NewTColorBox{isd}{O{}D(){black}}{%
	side={#2},
	#1,
}

\tcbset{
	side/.style={
			arc=0pt, boxsep=0mm,
			notitle, oversize, nobeforeafter,
			enhanced, frame hidden,
			colframe=#1, colback=#1back,
			sidebyside, sidebyside align=center, valign=center,
			subtitle style={
					enhanced,
					frame hidden,
					interior hidden,
					halign=center,
					fontupper={\color{#1}},
					fonttitle=\bfseries,
					colframe=#1, colback=#1back,
					% coltitle=#1, colbacktitle=#1back,
				},
		}
}

% For side adapt box
\NewDocumentCommand{\sde}{sO{}r()D<>{box}d""D''{l}mmm}{%
\tcbsidebyside[
	base,
	colframe=#3,
	sidebyside adapt=#2,
	#6icon=\IfBooleanTF{#1}{#5}{#3},
	#4={#3}{#7},
]{#8}{#9}
}
\NewDocumentCommand{\sds}{sO{}r()D<>{box}d""D''{l}mmm}{%
\tcbsidebyside[
	base,
	step=#3,
	colframe=#3,
	sidebyside adapt=#2,
	#6icon=\IfBooleanTF{#1}{#5}{#3},
	#4={#3}{\csname name#3\endcsname~\expandafter\csname the#3\endcsname~:~#7},
]{#8}{#9}
}

% Useful styles to add to a box
\tcbset{heart/.style={overlay={
					\node[below left] at (frame.north west)
					{\includegraphics[width=1.2cm]{\PREPA/figures_generales/heart.jpg}};}}}

\tcbset{hand/.style={overlay={
					\node[below left] at (frame.north west)
					{\includegraphics[width=1.2cm]{\PREPA/figures_generales/pr.jpg}};}}}

\tcbset{dngr/.style={overlay={
					\node[below left, scale=2] at (frame.north west)
					{\danger};}}}

\tcbset{trans/.style={overlay={
					\node[xshift=-0.8cm, yshift=-0.75cm] at (frame.north west)
					{\includegraphics[angle=-90, origin=c, height=1.2cm]{\PREPA/figures_generales/pr.jpg}};}}}

\newcommand{\includehand}[2]{
	\includegraphics[angle=#1,
		origin=c,
		height=#2]{\PREPA/figures_generales/pr.jpg}
}

\newcommand{\includeheart}[2]{
	\vspace*{-20pt}
	\includegraphics[angle=#1,
		origin=c,
		height=#2]{\PREPA/figures_generales/heart.jpg}
}

% For bigger boxrule in fbox
\edef\oldfboxrule{\the\fboxrule}
\newcommand{\fatbox}[1]{\setlength{\fboxrule}{1pt}\fbox{#1}\setlength{\fboxrule}{\oldfboxrule}}

% Journal abbreviations
\newcommand*\aap{A\&A}
\let\astap=\aap
\newcommand*\aapr{A\&A~Rev.}
\newcommand*\aaps{A\&AS}
\newcommand*\actaa{Acta Astron.}
\newcommand*\aj{AJ}
\newcommand*\ao{Appl.~Opt.}
\let\applopt\ao
\newcommand*\apj{ApJ}
\newcommand*\apjl{ApJ}
\let\apjlett\apjl
\newcommand*\apjs{ApJS}
\let\apjsupp\apjs
\newcommand*\aplett{Astrophys.~Lett.}
\newcommand*\apspr{Astrophys.~Space~Phys.~Res.}
\newcommand*\apss{Ap\&SS}
\newcommand*\araa{ARA\&A}
\newcommand*\azh{AZh}
\newcommand*\baas{BAAS}
\newcommand*\bac{Bull. astr. Inst. Czechosl.}
\newcommand*\bain{Bull.~Astron.~Inst.~Netherlands}
\newcommand*\caa{Chinese Astron. Astrophys.}
\newcommand*\cjaa{Chinese J. Astron. Astrophys.}
\newcommand*\fcp{Fund.~Cosmic~Phys.}
\newcommand*\gca{Geochim.~Cosmochim.~Acta}
\newcommand*\grl{Geophys.~Res.~Lett.}
\newcommand*\iaucirc{IAU~Circ.}
\newcommand*\icarus{Icarus}
\newcommand*\jcap{J. Cosmology Astropart. Phys.}
\newcommand*\jcp{J.~Chem.~Phys.}
\newcommand*\jgr{J.~Geophys.~Res.}
\newcommand*\jqsrt{J.~Quant.~Spectr.~Rad.~Transf.}
\newcommand*\jrasc{JRASC}
\newcommand*\memras{MmRAS}
\newcommand*\memsai{Mem.~Soc.~Astron.~Italiana}
\newcommand*\mnras{MNRAS}
\newcommand*\na{New A}
\newcommand*\nar{New A Rev.}
\newcommand*\nat{Nature}
\newcommand*\nphysa{Nucl.~Phys.~A}
\newcommand*\pasa{PASA}
\newcommand*\pasj{PASJ}
\newcommand*\pasp{PASP}
\newcommand*\physrep{Phys.~Rep.}
\newcommand*\physscr{Phys.~Scr}
\newcommand*\planss{Planet.~Space~Sci.}
\newcommand*\pra{Phys.~Rev.~A}
\newcommand*\prb{Phys.~Rev.~B}
\newcommand*\prc{Phys.~Rev.~C}
\newcommand*\prd{Phys.~Rev.~D}
\newcommand*\pre{Phys.~Rev.~E}
\newcommand*\prl{Phys.~Rev.~Lett.}
\newcommand*\procspie{Proc.~SPIE}
\newcommand*\qjras{QJRAS}
\newcommand*\rmxaa{Rev. Mexicana Astron. Astrofis.}
\newcommand*\skytel{S\&T}
\newcommand*\solphys{Sol.~Phys.}
\newcommand*\sovast{Soviet~Ast.}
\newcommand*\ssr{Space~Sci.~Rev.}
\newcommand*\zap{ZAp}

%%% Fin du package
\endinput
