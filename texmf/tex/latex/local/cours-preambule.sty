\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{cours-preambule}
\RequirePackage{locdef}

\RequirePackage[authoryear]{natbib}
\setcitestyle{aysep={}}
\setcitestyle{citesep={~;}}
\RequirePackage[utf8x]{inputenc}
\RequirePackage[T1]{fontenc}
\RequirePackage[french]{babel}
% Pour l'alphabet phonétique international TIPA
% \RequirePackage{tipa}
% Enlever l'espace après la virgule pour les nombres
\RequirePackage{icomma}
\frenchbsetup{StandardLists=true}

% Symbols
\RequirePackage{pifont}
\newcommand{\cmark}{\ding{51}}%
\newcommand{\xmark}{\ding{55}}%
\newcommand{\hand}{\ding{45}}%
% Knuth and danger \dbend
\RequirePackage{manfnt}
% Selfmade with stackrel
% https://tex.stackexchange.com/a/483175/284518
\RequirePackage{stackengine}
\RequirePackage{scalerel}
\newcommand\danger[1][2ex]{%
	\scaleto{\stackengine{0.3pt}{\scalebox{1.1}[.9]{%
				\color{black}$\blacktriangle$}}{\color{white}\tiny\bfseries !}{O}{c}{F}{F}{L}}{#1}%
}

% Test adding text
\RequirePackage{lipsum}

% Better file and folder management
\RequirePackage{subfiles}
% To make a landscape document
\RequirePackage{pdflscape}
% Define margins globally
\RequirePackage[hmargin=1.5cm, vmargin=1.5cm]{geometry}
% To locally change margins
\RequirePackage{changepage}
% To resize tables inside threeparttable for instance
\RequirePackage{adjustbox}
% For frames in multiple lines
\RequirePackage{framed}
% For better vectors
\RequirePackage{esvect}

\RequirePackage{lastpage}
%%% En-tête et pied de page
\RequirePackage{fancyhdr}
\pagestyle{fancy}
\renewcommand{\headrulewidth}{1pt}
\fancyhead[RE]{\nouppercase\leftmark}  % Top (head) right (R) even (E): chapter
\fancyhead[LE]{\thepage}               % Top left even: page
\fancyhead[LO]{\nouppercase\rightmark} % Top (head) left (L) odd (O): chapter
\fancyhead[RO]{\thepage}               % Top right even: page
\fancyfoot[L]{Lycée \textsc{Pothier}}
\fancyfoot[C]{\textbf{\thepage/\pageref*{LastPage}}}
\fancyfoot[R]{MPSI -- 2023/2024}
%\fancyfoot{}                           % Empty footer
\renewcommand{\footrulewidth}{1pt}
% Space before ruler
%\setlength{\headheight}{28pt}

% Redefine the plain page style for chapter pages
\fancypagestyle{plain}{%
	\renewcommand{\headrulewidth}{0pt}  % Line at the header invisible
	\fancyhf{}%
	\fancyfoot[L]{Lycée \textsc{Pothier}}
	\fancyfoot[C]{\textbf{\thepage/\pageref*{LastPage}}}
	\fancyfoot[R]{MPSI -- 2023/2024}
	\renewcommand{\footrulewidth}{1pt}% Line at the footer visible
}

% Make sure empty pages between chapters don't have a ruler
\RequirePackage{emptypage}
% Float pages empty
\RequirePackage{floatpag}
\floatpagestyle{fancy}
% Force float Here
\RequirePackage{float}

% Colors
\RequirePackage[svgnames, dvipsnames, table]{xcolor}
\definecolor{urlcolor}{rgb}{0,0,1}
\definecolor{dgreen}{rgb}{.1,.6,.1}
\definecolor{brandeisblue}{rgb}{0.0, 0.44, 1.0}
\definecolor{cornflowerblue}{rgb}{0.3921, 0.5843, 0.9294}
\definecolor{limegreen}{rgb}{0.2, 0.8, 0.2}
\definecolor{firebrick}{rgb}{0.7, 0.13, 0.13}

% For \cancel and \bcancel functions
\RequirePackage{cancel}
\newcommand{\dcancel}[1]{
	\cancel{\bcancel{#1}}
}
% Lots of useful shorthands
\RequirePackage{physics}
% Same for chemistry: \ch{H2O} works nice
% Weird error of inputs limit on pgfmathfunction.code.tex…
% \RequirePackage{chemmacros}
% \chemsetup{modules=base, errorcheck, chemformula, charges, phases}
% \chemsetup[phases]{pos=sub}
\RequirePackage{chemfig}
\definesubmol{&0}{-[0,,,,draw=none]}
\definesubmol{&1}{-[1,,,,draw=none]}
\definesubmol{&2}{-[2,,,,draw=none]}
\definesubmol{&3}{-[3,,,,draw=none]}
\definesubmol{&4}{-[4,,,,draw=none]}
\definesubmol{&5}{-[5,,,,draw=none]}
\definesubmol{&6}{-[6,,,,draw=none]}
\definesubmol{&7}{-[7,,,,draw=none]}
\RequirePackage[version=4]{mhchem}
\RequirePackage{elements}

% For cases quantiques
\newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}
\newcommand{\casea}[1]{
	\begin{tabular}{|P{8pt}|}\hline
		\leftskip=-2pt$#1$
		\\\hline
	\end{tabular}
}
\newcommand{\casec}[3]{
	\begin{tabular}{|P{8pt}|P{8pt}|P{8pt}|}\hline
		\leftskip=-2pt$#1$ & \leftskip=-2pt$#2$ & \leftskip=-2pt$#3$
		\\\hline
	\end{tabular}
}

% Pour \Aboxed dans un environnement align
\RequirePackage{mathtools}
\newtagform{black}{\color{black}(}{)}
% Overbrace and brackets same height with phantom of big fraction
% https://tex.stackexchange.com/a/119998/284518
\newcommand{\xunderbrace}[2][\vphantom{\dfrac{A}{A}}]{\underbrace{#1#2}}
\newcommand{\xunderbracket}[2][\vphantom{\dfrac{A}{A}}]{\underbracket[1pt]{#1#2}}
\newcommand{\xoverbrace}[2][\vphantom{\dfrac{A}{A}}]{\overbrace{#1#2}}
\newcommand{\xoverbracket}[2][\vphantom{\dfrac{A}{A}}]{\overbracket[1pt]{#1#2}}
% To pagebreak equations
\allowdisplaybreaks
% Pour empheq, qui pourrait remplacer à la fois équations et align
\RequirePackage{empheq}
% Pour \endnote
\RequirePackage{endnotes}
%% make it prettier
\renewcommand*{\notesname}{\hspace{-1.1cm} Notes}
\makeatletter
\renewcommand*{\enoteheading}{%
	\section*{\notesname}%
	\markboth{\notesname}{\notesname}}
\makeatother
\renewcommand{\enotesize}{\normalsize}
\renewcommand{\makeenmark}{\textcolor{magenta}{\hbox{$^{\theenmark}$}}}
\renewcommand\enoteformat{%
	\raggedright
	\leftskip=1.8em
	\makebox[0pt][r]{\textcolor{magenta}{\theenmark}~\rule{0pt}{\dimexpr\ht\strutbox+\baselineskip}}%
}
% Make it clickable?
\RequirePackage{hyperendnotes}
% Toggle switch in order to turn on/off back-links in the
% endnote-section:
\enotelinkstrue
%\enotelinksfalse

% Idk really: endnotes~?
\makeatletter
\newcommand*{\toccontents}{\@starttoc{toc}}
\def\enoteheading{\section*{\notesname
	  \@mkboth{\MakeUppercase{\notesname}}{\MakeUppercase{\notesname}}}%
	\mbox{}\par\vskip-2.3\baselineskip\noindent\rule{.5\textwidth}{0.4pt}
	\par\vskip\baselineskip}
\makeatother

% Read linux paths
\ExplSyntaxOn
\NewDocumentCommand{\getenv}{om}
{
	\sys_get_shell:nnN { kpsewhich ~ --var-value ~ #2 }
	{ \cctab_select:N \c_str_cctab } \l_tmpa_tl
	\tl_trim_spaces:N \l_tmpa_tl
	\IfNoValueTF { #1 }
	{ \tl_use:N \l_tmpa_tl }
	{ \tl_set_eq:NN #1 \l_tmpa_tl }
}
\ExplSyntaxOff

% set \PREPA
\getenv[\PREPA]{PREPA}

\newcommand{\dodd}{\PREPA/2022/}
\newcommand{\dodt}{\PREPA/2023/}

% Figures
\RequirePackage{graphicx}%[pdftex]{graphicx}
\RequirePackage{svg}
\RequirePackage[noframe]{draftfigure}
\graphicspath{{./figures/}{../figures/}{./svg-inkscape}
		{../figures/ch1/}{../figures/ch2/}{../figures/ch3/}{../figures/ch4/}{../figures/ch5/}{../figures/ch6/}
		{../figures/ch7/}{../figures/ch8/}{../figures/ch9/}{../figures/ch10/}{../figures/ch11/}{../figures/ch12/}
		{../figures/ch13/}{../figures/ch14/}{../figures/ch15/}{../figures/ch16/}{../figures/ch17/}{../figures/ch18/}
		{../figures/ch19/}{../figures/ch20/}{../figures/ch21/}{../figures/ch22/}{../figures/ch23/}{../figures/ch24/}
		{../figures/ch25/}{../figures/ch26/}{../figures/ch27/}{../figures/ch28/}{../figures/ch29/}{../figures/ch30/}
		{../figures/ch31/}{../figures/ch32/}{../figures/ch33/}{../figures/ch34/}{../figures/ch35/}{../figures/ch36/}
		{../figures/ch37/}{../figures/ch38/}{../figures/ch39/}{../figures/ch40/}{../figures/ch41/}{../figures/ch42/}
}
% Figures next to text
\RequirePackage{wrapfig}
% Caption right of figure
\RequirePackage[rightcaption]{sidecap}
\sidecaptionvpos{figure}{t}
% General caption
\RequirePackage[labelfont=bf, font=small]{caption}
\captionsetup[table]{name=Tableau}
% For subfigures
\RequirePackage{subcaption}
% To have \footnotes at bottom of page when called inside subfigures
% Needs LaTeX 2020 and plus, https://tex.stackexchange.com/a/414191
% \AddToHook{env/figure/begin}{%
%   \DeclareRobustCommand\footnote[1]{%
%     \footnotemark
%     \expanded{\AddToHookNext{env/figure/after}%
%       {\noexpand\setcounter{footnote}{\thefootnote}%
%        \noexpand\footnotetext\unexpanded{{#1}}}}}}
% Useful to center wide tables or figures
\makeatletter
\newcommand*{\centerfloat}{%
	\parindent \z@
	\leftskip \z@ \@plus 1fil \@minus \textwidth
	\rightskip\leftskip
	\parfillskip \z@skip}
\makeatother
% center graphics inline
% $\vcenter{\hbox{\includegraphics{temp.jpg}}}$

% Nice chapter
\RequirePackage{titlesec}
% Put numbers in Roman
% \renewcommand{\thechapter}{\Roman{chapter}}
% For TOC with chapter numbers right-aligned, fixing the spilling of VII on text
\RequirePackage[rightlabels]{titletoc}
% Make chapter with frame
\makeatletter
\titleformat{\chapter}[frame]
{\normalfont\setlength{\fboxrule}{1pt}}
{\filright\enspace \@chapapp~\thechapter\enspace}
{8pt}{\LARGE\bfseries\filcenter}
\titlespacing*{\chapter}
{0pt}{0pt}{20pt}
\makeatother

\renewcommand{\thesection}{\Roman{section}}
\renewcommand{\thesubsection}{\Alph{subsection}}
\renewcommand{\thesubsubsection}{\Roman{section}.\Alph{subsection}.\arabic{subsubsection}}

\titleformat{\section}{\Large\bfseries}{
	\begin{tikzpicture}[scale=0.55, overlay]
		\draw[line width=1pt, color=darkgray, xshift=1em, yshift=0.6em]
		(1,-0.4) -- (1,0.8) --(0.8,1) -- (-0.8,1) -- (-1,0.8) -- (-1,-0.8) --
		(-0.8,-1) -- (32,-1);
		\node[xshift=0.6em, yshift=0.35em] at (0,0)
		{\rmfamily\textcolor{darkgray}{\thesection}};
	\end{tikzpicture}}{0.4em}{\hspace{1.4em}}

\titleformat{\subsection}{\large\bfseries}{\hspace{1cm}
	\tcbox[colback=darkgray, colframe=darkgray,
		coltext=lightgray, on line, boxsep=0pt,
		left=4pt, right=4pt, top=4pt,bottom=4pt,
		sharp corners=northwest]{\thesubsection}}{0.5em}{}

\titleformat{\subsubsection}{\normalsize}{\hspace{2cm}
	\tcbox[colback=white, colframe=darkgray,
		coltext=black, on line, boxsep=0pt,
		left=4pt, right=4pt, top=4pt,bottom=4pt,
		sharp corners=northwest]{\normalsize\thesubsubsection}
	\normalsize}{0.5em}{}

% Nice epigraph
\RequirePackage{epigraph}
\setlength\epigraphwidth{.5\textwidth}
\newenvironment{myepistyle}{\hspace{-7.8pt}}{}
\renewcommand{\textflush}{myepistyle}
% Pour local TOC
% \RequirePackage{minitoc}
% \renewcommand{\mtctitle}{Sommaire}
% \renewcommand{\mlttitle}{Tableaux}
% Pour glossaire
% \RequirePackage{glossaries-extra}

%\RequirePackage{xurl}
%\PassOptionsToPackage{hyphens}{url} % For hyphens in too long urls
\RequirePackage[pdftex,
	pdftitle={Cours de Physique-Chimie de la MPSI 3 du Lyc\'ee Pothier},
	pdfauthor={Nora NICOLAS},
	pdfsubject={Ressources de cours pour l'ann\'ee},
	pdfkeywords={physique, chimie, optique, m\'ecanique, m\'ethode, analyse,
			r\'eflexion},
	breaklinks=true,        % For urls too long
	linktoc=page,           % Titre pas clicable mais page si
	backref=page,           % Add link to go back to section
	colorlinks=true,        % false: boxed links; true: colored links
	linkcolor=dgreen,       % color of internal links
	citecolor=magenta,      % color of links to bibliography
	urlcolor=urlcolor,      % color of external links
	pdfencoding=auto,       % http://tex.stackexchange.com/questions/119079
	psdextra=true,          % for '$' in title
	pdfstartview=FitV,      % open fitting view as default
	hyperfootnotes=true,    % Make the footnote marks into hyperlink to text
	hyperindex=true,
	hyperfigures=false]{hyperref}
\def\UrlBreaks{\do\/\do-}
% Add an upward arrow next to backref,
% from https://tex.stackexchange.com/a/173063
\renewcommand\backrefxxx[3]{%
	\hyperlink{page.#1}{$\uparrow$~Page #1}}
% Make ref to multiple sections with \cref: doesn't seem to work...
% \RequirePackage{cleveref}

% Reinitialise footnote number each page
% \RequirePackage[perchapter]{footmisc}
% Allow referencing to prevous footnote even if mark not a number
% https://tex.stackexchange.com/a/35044
\makeatletter
\newcommand\footnoteref[1]{\protected@xdef\@thefnmark{\ref{#1}}\@footnotemark}
\makeatother

% Pour les plots
\RequirePackage{pgfplots}
\pgfplotsset{compat=newest}

% Draw nice quotes in TiKz
\RequirePackage{tikz}
\newcommand*{\openquote}{%
	\tikz[remember picture, overlay, xshift=-5pt, yshift=0pt]
	\node[black!30] (OQ) {\fontfamily{qbk}\fontsize{50}{60}\selectfont«};%
	\kern4pt
}
\newcommand*{\closequote}{%
	\tikz[remember picture, overlay, xshift=10pt, yshift=0pt]
	\node[black!30] (CQ) {\fontfamily{qbk}\fontsize{50}{60}\selectfont»};%
}
\usetikzlibrary{trees, positioning, arrows, tikzmark, calc}
% Circled numbers
% https://tex.stackexchange.com/a/7045
\newcommand*\circled[1]{%
	\tikz[baseline=(char.base)]{%
		\node[shape=circle, draw, inner sep=1pt, minimum size=3ex] (char) {#1};
	}
}

\RequirePackage{microtype}

% Pour des flèches entre les lignes d'un align: need more recent LaTeX...
\RequirePackage{witharrows}
\WithArrowsOptions{displaystyle}
% Math symbols
\RequirePackage{amsmath, amssymb} % , amsthm}
\DeclareMathOperator{\acosh}{argch}
\DeclareMathOperator{\asinh}{argsh}
\let\cosh\relax
\DeclareMathOperator{\cosh}{ch}
\let\sinh\relax
\DeclareMathOperator{\sinh}{sh}
% To manually put \blacksquare flushedright of align* environnement
% https://tex.stackexchange.com/a/144984/284518
\newcommand{\qed}{\tag*{$\blacksquare$}}
\newcommand{\qef}{\tag*{$\square$}}
\newcommand{\hqed}{\hfill{$\blacksquare$}}
\newcommand{\hqef}{\hfill{$\square$}}
\RequirePackage{textcomp}
\RequirePackage{eurosym}
% For integrals
\RequirePackage{esint}
% for some commands like \degree, \celsius, \micro in both text and maths mode
\RequirePackage{gensymb}

% Resume enumerate and set list
\RequirePackage{enumitem}

% Pretty tables
\RequirePackage{booktabs}
% Title, table and notes
\RequirePackage{threeparttable}
% redefine the minimum amount of space that is used by the caption and the notes
% https://tex.stackexchange.com/a/355973
\renewcommand{\TPTminimum}{\linewidth}
% Set caption of notes to \small
% \appto\TPTnoteSettings{\small}
% Self-explanatory
\RequirePackage{multirow}
% Pour écrire côte à côte dans les tcolorboxes
\RequirePackage{multicol}
\setlength\columnseprule{.4pt}
% Other tables
\RequirePackage{tabularx}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcolumntype{M}{>{\centering\arraybackslash}m}
\renewcommand\tabularxcolumn[1]{>{\vspace{\fill}}m{#1}<{\vspace{\fill}}}
% \renewcommand\tabularxcolumn[1]{m{#1}}
% Multicolumn with X column spanning entire row
% https://tex.stackexchange.com/a/544644/284518 in the comments
\newcommand{\mcl}[4]{\multicolumn{#1}{#2>{
\hsize=\dimexpr#1\hsize+\tabcolsep*(2*(#1-1))+\arrayrulewidth*(#1-2)\relax
}#3}{#4}}
% For arrays
\arraycolsep=1.4pt

% For dashed lines in tables
\RequirePackage{arydshln}
% Dashrule
\RequirePackage{dashrule}
% Rotate elements, and hence big tables
%\RequirePackage{adjustbox}
%\RequirePackage[graphicx]{realboxes}
\RequirePackage{rotating}
% Emojis
\RequirePackage{twemojis}

% Pretty units
\RequirePackage{siunitx}[=v2]
\NewCommandCopy\mycdot\cdot
\sisetup{%
	detect-all,
	free-standing-units,           % create standalone commands
	locale=FR,                     % language
	inter-unit-product=
		{\ensuremath{\mycdot}},  % character between units
	separate-uncertainty,          % x ± dx
	retain-explicit-plus,          % p.ex. +45°
	range-units=brackets,          % (0 to 40) m
	range-phrase=~;~,              % 0~;~40 m
	% range-phrase=\textup{--},    % 0--40 m
	% open-bracket= [,
	% close-bracket= ],
	% angle-symbol-over-decimal,   % p.ex. 0.''11
}
\def\Lsun{L\ensuremath{_{\odot}}}
\def\Rsun{R\ensuremath{_{\odot}}}
\def\Tsun{T\ensuremath{_{\odot}}}
\def\Msun{M\ensuremath{_{\odot}}}
\def\Rearth{R\ensuremath{_{\oplus}}}
\def\Mearth{M\ensuremath{_{\oplus}}}
\def\Tearth{T\ensuremath{_{\oplus}}}
\DeclareSIUnit\pc{pc}           % parsec
\DeclareSIUnit\as{as}           % arcsec
\DeclareSIUnit\mag{mag}         % mag
\DeclareSIUnit{\angstrom}{\textup{\AA}}
\DeclareSIUnit{\EUR}{\text{\euro}}
% Tabular sinuit~: S[table-format=1.2e-2]
% Sitime, https://tex.stackexchange.com/a/511875/284518
% Doesn't work, invalid token in number
\makeatletter
\newcommand{\sitime}[1]{\sitime@aux#1;;;\@nil}
\def\sitime@aux#1;#2;#3;#4\@nil{%
	\@ifmtarg{#1#2#3}%
	{%
		\PackageError{siunitx (modified)}%
		{Empty \string\sitime\space argument}{}%
	}%
	{%
		\@ifmtarg{#1}{}{\SI{#1}{\hour}\@ifmtarg{#2#3}{}{\csname l_siunitx_number_unit_separator_tl\endcsname}}%
		\@ifmtarg{#2}{}{~ \SI{#2}{\minute}\@ifmtarg{#3}{}{\csname l_siunitx_number_unit_separator_tl\endcsname}}%
		\@ifmtarg{#3}{}{~\SI{#3}{\second}}%
	}%
}
\makeatother

% Math in section names
\RequirePackage{bookmark} % http://tex.stackexchange.com/questions/119079

% Include code, but there might be a better package
% Try \RequirePackage{pythonhighlight}
% https://github.com/olivierverdier/python-latex-highlighting
\RequirePackage{listingsutf8}
\lstset{inputencoding=utf8/latin1}
\definecolor{fond}{gray}{0.95}
\lstnewenvironment{python}{
\lstset{language     = python,
basicstyle       = \ttfamily,
keywordstyle     = \bfseries\ttfamily\color{green!40!black},
commentstyle     = \itshape\color{purple!40!black},
identifierstyle  = \color{black},
stringstyle      = \color{black},
backgroundcolor  = \color{fond},
numbers          = none,
frame            = leftline,
framerule        = 3pt,
rulecolor        = \color{gray},
showstringspaces = false
extendedchars    = true,
literate         = {á}{{\'a}}1
{à}{{\`a}}1
{ã}{{\~a}}1
{é}{{\'e}}1,
}}{}

% Include verbatim in text
\RequirePackage{fancyvrb}
% To customize it see for instance https://tex.stackexchange.com/a/85218

% Profondeur des sections dans la table of contents
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{4}

% Définition des puces des listes
%\setlist{nosep} % Interligne nul
\setlist{itemsep=3pt} % Interligne nul
\setlist[enumerate,1]{leftmargin=10pt, label=\arabic*)}
\setlist[enumerate,2]{leftmargin=20pt, label=\alph* --}
\setlist[enumerate,3]{leftmargin=30pt, label=\roman*.}
\setlist[itemize,1]{leftmargin=10pt}
\setlist[itemize,2]{leftmargin=20pt}
\setlist[itemize,3]{leftmargin=30pt}

% Setup clitem et sqitem
\newif\iffitem
	\newcommand{\setupmodenumerate}{%
	\global\fitemfalse
	\let\origmakelabel\makelabel
	\def\fitem##1{\global\fitemtrue\def\toapply{##1}\item}%
	\def\makelabel##1{%
\origmakelabel{%
	\iffitem{%
		\renewcommand{\labelenumi}{\arabic{enumi}}%
		\renewcommand{\labelenumii}{\alph{enumii}}%
		\renewcommand{\labelenumiii}{\roman{enumiii}}%
		\toapply{##1}%
	}%
\else##1\fi}%
\global\fitemfalse
}%
}
\setlist[enumerate]{before=\setupmodenumerate}
% Number in squares
\newcommand{\sqenumi}{\protect\fbox{\arabic*}}
\newcommand{\sqitem}{\fitem{\fbox}}
% Number in circles
\newcommand{\clenumi}{\protect\circled{\arabic*}}
\newcommand{\clitem}{\fitem{\circled}}
% Description with numbers
\newcommand\litem[1]{\item{\bfseries #1}}
\setlist[itemize, 1]{label = --}
\setlist[itemize, 2]{label = $\bullet$}
% Setup points left of enumerate
\RequirePackage{tabto}
\newcommand\pts[1]{\tabto*{-2.5\leftmargin}\textcolor{ForestGreen}{\llap{/#1~}\tabto{\TabPrevPos}}}
\newcommand{\nitem}[1]{\item\pts{#1}}

% Bolditemize
% https://tex.stackexchange.com/a/266229
\newenvironment{bolditemize}{\begin{itemize} }{\end{itemize}}
\expandafter\def\expandafter\bolditemize\expandafter{%
	\bolditemize \let\olditem\item \def\item[##1]{\olditem \textbf{##1}}}

\newcommand{\ed}[2]{#1\endnote{\textcolor{black}{#1} : #2}}
\newcommand{\obar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}
\newcommand{\opto}[2]{\xrightarrow[#2]{#1}}
\newcommand{\prob}[2]{\mathcal{P}\left(#1 \mid #2\right)}
\newcommand{\moy}[1]{\left\langle #1 \right\rangle}

% Environnements de mises en valeur
\RequirePackage[many]{tcolorbox}
\tcbuselibrary{skins, raster, xparse}

% Useful tools
\RequirePackage{etoolbox}
\RequirePackage{xstring}
\RequirePackage{footnote}
% Footnotes outside tcboxes
% \BeforeBeginEnvironment{tcolorbox}{\savenotes}
% \AfterEndEnvironment{tcolorbox}{\spewnotes}

% New commands for pretty formatting (TP)
\newlength{\leftlength}
\newlength{\rightlength}

\newcommand{\leftcentersright}[3]{
	\medskip
	\settowidth{\leftlength}{#1}
	\settowidth{\rightlength}{#3}
	\noindent#1\hskip-\leftlength
	\hfill{#2}\hfill
	\mbox{}\hskip-\rightlength#3
	\medskip
}

\newcommand{\centers}[1]{\leftcentersright{}{#1}{}}
\newcommand{\leftcenters}[2]{\leftcentersright{#1}{#2}{}}
\newcommand{\centersright}[2]{\leftcentersright{}{#1}{#2}}
\newcommand{\leftencadreright}[3]{\leftcentersright{#1}{\fbox{#2}}{#3}}
\newcommand{\encadre}[1]{\leftcentersright{}{\fbox{#1}}{}}
\newcommand{\leftencadre}[2]{\leftcentersright{#1}{\fbox{#2}}{}}
\newcommand{\encadreright}[2]{\leftcentersright{}{\fbox{#1}}{#2}}

\newcommand{\encadreminipage}[2]{%
	\leftcentersright{}{\fbox{%
			\begin{minipage}{#1} #2 \end{minipage}%
		}}{}%
}

\newcommand{\centersminipage}[2]{%
	\leftcentersright{}{%
		\begin{minipage}{#1} #2 \end{minipage}%
	}{}%
}

% ??
\newcommand{\Sim}{\ensuremath{\mathop{\sim}\limits}}

% Make toggle for teacher and student version of file
\newtoggle{student}
\togglefalse{student}
\newcommand{\ifstudent}[1]{
	\iftoggle{student}{%
		#1%
	}{}
}
\newcommand{\ifprof}[1]{
	\iftoggle{student}{%
	}{
		#1%
	}
}
\newcommand{\switch}[2]{
	\iftoggle{student}{%
		#2%
	}{%
		#1%
	}%
}

% Command for easy color switch
\newcommand{\cswitch}[2]{%
	\textcolor{\switch{black!100}{#1!10}}{%
		#2%
	}%
}

% To make `hide` command
% https://tex.stackexchange.com/a/135485/284518
\RequirePackage{varwidth}
\newcommand\hide[1]{\phantom{\varwidth{\linewidth}#1\endvarwidth}}
% \toggletrue{student} will hide the command
\newcommand{\hswitch}[1]{
	\iftoggle{student}{
		\hide{#1}
	}{
		#1
	}
}

% Hide environment
\RequirePackage{comment}
\newif\ifHideSolutions
% Make a solution environment
\generalcomment{hide}{%
	\begingroup
	\ifHideSolutions%
		% if \HideSolutionstrue is not called, then we remove the contents
		\def\ProcessCutFile{}\fi%
}{%
	\ifHideSolutions%
		% aand,now (also when it's not called), we make a box
		% and then we \input the \CommentCutFile.
		\setbox1=\vbox{\input{\CommentCutFile}}%
		% Get the height from \ht1 and use \vskip to make appropriate space
		\vskip\ht1
	\fi
	\endgroup%
}

% Boxes types: colors
\colorlet{loi}{red!60!black}
\colorlet{theo}{red!70!black}
\colorlet{ques}{red!80!black}
\colorlet{prop}{red!80!black}
\colorlet{demo}{blue!80!black}
\colorlet{coro}{VioletRed!60!black}
\colorlet{inte}{RoyalBlue!50!black}
\colorlet{impl}{DodgerBlue!50!black}
\colorlet{impo}{BlueViolet!70!black}
\colorlet{tool}{BlueViolet!80!black}
\colorlet{rapp}{BlueViolet!60!black}
\colorlet{defi}{green!60!black}
\colorlet{data}{green!60!black}
\colorlet{nota}{green!50!black}
\colorlet{ror}{orange!80!black}
\colorlet{exem}{lightgray!55!black}
\colorlet{odgr}{lightgray!50!black}
\colorlet{appl}{gray!50!black}
\colorlet{rema}{darkgray!50!black}
% for backs in fill style
\colorlet{loiback}{red!10}
\colorlet{theoback}{red!10}
\colorlet{quesback}{red!10}
\colorlet{propback}{red!10}
\colorlet{demoback}{blue!10}
\colorlet{coroback}{VioletRed!10}
\colorlet{inteback}{RoyalBlue!10}
\colorlet{implback}{DodgerBlue!10}
\colorlet{impoback}{BlueViolet!10}
\colorlet{toolback}{BlueViolet!10}
\colorlet{rappback}{BlueViolet!10}
\colorlet{defiback}{green!10}
\colorlet{toolback}{green!10}
\colorlet{notaback}{green!10}
\colorlet{rorback}{orange!10}
\colorlet{exemback}{lightgray!10}
\colorlet{odgrback}{lightgray!10}
\colorlet{applback}{gray!10}
\colorlet{remaback}{darkgray!10}
\colorlet{blackback}{white}
% set names for counters
\newcommand{\nameloi}{Loi}
\newcommand{\nametheo}{Théorème}
\newcommand{\nameques}{Question}
\newcommand{\nameprop}{Propriété}
\newcommand{\namedemo}{Démonstration}
\newcommand{\namecoro}{Corollaire}
\newcommand{\nameinte}{Interprétation}
\newcommand{\nameimpl}{Implication}
\newcommand{\nameimpo}{Important}
\newcommand{\nametool}{Outils}
\newcommand{\namerapp}{Rappel}
\newcommand{\namedefi}{Définition}
\newcommand{\namedata}{Données}
\newcommand{\namenota}{Notation}
\newcommand{\nameror}{Important}
\newcommand{\nameexem}{Exemple}
\newcommand{\nameodgr}{Ordre de grandeur}
\newcommand{\nameappl}{Application}
\newcommand{\namerema}{Remarque}
% set counters
\newcounter{loi}[chapter]
\renewcommand{\theloi}{\thechapter.\arabic{loi}}
\newcounter{theo}[chapter]
\renewcommand{\thetheo}{\thechapter.\arabic{theo}}
\newcounter{ques}[chapter]
\renewcommand{\theques}{\thechapter.\arabic{ques}}
\newcounter{prop}[chapter]
\renewcommand{\theprop}{\thechapter.\arabic{prop}}
\newcounter{demo}[chapter]
\renewcommand{\thedemo}{\thechapter.\arabic{demo}}
\newcounter{coro}[chapter]
\renewcommand{\thecoro}{\thechapter.\arabic{coro}}
\newcounter{inte}[chapter]
\renewcommand{\theinte}{\thechapter.\arabic{inte}}
\newcounter{impl}[chapter]
\renewcommand{\theimpl}{\thechapter.\arabic{impl}}
\newcounter{impo}[chapter]
\renewcommand{\theimpo}{\thechapter.\arabic{impo}}
\newcounter{tool}[chapter]
\renewcommand{\thetool}{\thechapter.\arabic{tool}}
\newcounter{rapp}[chapter]
\renewcommand{\therapp}{\thechapter.\arabic{rapp}}
\newcounter{defi}[chapter]
\renewcommand{\thedefi}{\thechapter.\arabic{defi}}
\newcounter{data}[chapter]
\renewcommand{\thedata}{\thechapter.\arabic{data}}
\newcounter{nota}[chapter]
\renewcommand{\thenota}{\thechapter.\arabic{nota}}
\newcounter{ror}[chapter]
\renewcommand{\theror}{\thechapter.\arabic{ror}}
\newcounter{exem}[chapter]
\renewcommand{\theexem}{\thechapter.\arabic{exem}}
\newcounter{odgr}[chapter]
\renewcommand{\theodgr}{\thechapter.\arabic{odgr}}
\newcounter{appl}[chapter]
\renewcommand{\theappl}{\thechapter.\arabic{appl}}
\newcounter{rema}[chapter]
\renewcommand{\therema}{\thechapter.\arabic{rema}}
\newcounter{null}[chapter]
\renewcommand{\thenull}{\thechapter.\arabic{null}}
% For icons
\usepackage{fontawesome5}
\tcbset{
	icon/.style={
			overlay={
					\node[anchor=center, scale=2]
					at ([shift={(-0.7,-0.4)}]frame.north west)
					{\csname icon#1\endcsname};
				}
		}
}
\newcommand{\iconloi}{\faIcon{drafting-compass}}
\newcommand{\icontheo}{\faIcon{drafting-compass}}
\newcommand{\iconques}{\faIcon{question}}
\newcommand{\iconprop}{\faIcon{drafting-compass}}
\newcommand{\icondemo}{\faIcon{list-ul}}
\newcommand{\iconcoro}{\faIcon{code-branch}}
\newcommand{\iconinte}{\faIcon{angle-double-right}}
\newcommand{\iconimpl}{\faIcon{angle-double-right}}
\newcommand{\iconimpo}{\faIcon{exclamation-triangle}}
\newcommand{\icontool}{\faIcon{wrench}}
\newcommand{\iconrapp}{\faIcon[regular]{bookmark}}
\newcommand{\icondefi}{\faIcon{book}}
\newcommand{\icondata}{\faIcon{database}}
\newcommand{\iconnota}{\faIcon{pencil-alt}}
\newcommand{\iconror}{\includegraphics[scale=.15]{\PREPA/figures_generales/heart.jpg}}
\newcommand{\iconexem}{\faIcon{cogs}}
\newcommand{\iconodgr}{\faIcon{calculator}}
\newcommand{\iconappl}{\faIcon{edit}}
\newcommand{\iconrema}{\faIcon[regular]{hand-point-right}}
%
\newcommand{\icondown}{\faIcon[regular]{hand-point-down}}
\newcommand{\iconknow}{\faIcon{brain}}
\newcommand{\iconhow}{\faIcon{flask}}
\newcommand{\iconbulb}{\faIcon[regular]{lightbulb}}
\newcommand{\iconmark}{\faIcon[regular]{bookmark}}

% My generic box name
% based on the great answer https://tex.stackexchange.com/a/471615/284518
\NewTColorBox{tcb}{sO{box}r()D<>{}d""m}{%
	base,
	icon=\IfBooleanTF{#1}{#5}{#3},
	#2={#3}{#6},
	#4,
}
% with numbers
\NewTColorBox{tcb*}{sO{box}r()D<>{}d""m}{%
	base,
	icon=\IfBooleanTF{#1}{#5}{#3},
	#2={#3}{\csname name#3\endcsname~\expandafter\csname the#3\endcsname~:~#6},
	step={#3},
	#4,
}

% Basic styles of boxes
% thanks to https://tex.stackexchange.com/a/252907/284518 for 2 args
\tcbset{
	base/.style={
			enhanced, sharp corners=uphill, valign=center,
		}
}
% Simple box
\tcbset{
	box/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
			borderline={1pt}{0pt}{#1}, coltitle=#1,
			fonttitle=\bfseries, top=10pt,
			attach boxed title to top left={yshift={-9pt}, xshift=10pt},
			boxed title style={enhanced, frame hidden, colback=white},
			title={#2},
		}
}
% Only left
\tcbset{
	lft/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
			borderline west={1pt}{0pt}{#1},
			overlay unbroken and first={%
					\node[rotate=90,
						minimum width=1cm,
						anchor=south,
						font=\bfseries,
						color=#1]
					at (frame.west) {#2};
				}
		}
}
\tcbset{
	lfnt/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
			borderline west={1pt}{0pt}{#1},
		}
}
% Only right
\tcbset{
	rgt/.style 2 args={
			borderline east={1pt}{0pt}{#1},
			boxrule=0pt, frame hidden, interior hidden,
			overlay unbroken and first ={%
					\node[rotate=90,
						minimum width=1cm,
						anchor=south,
						font=\bfseries,
						color=#1]
					at ([shift={(16pt,0)}]frame.east) {#2};
				}
		}
}
% Empty
\tcbset{
	non/.style 2 args={
			boxrule=0pt, frame hidden, interior hidden,
		}
}
% Old box style
\tcbset{
	fil/.style 2 args={
			fonttitle=\bfseries,
			colback=#1back,
			colframe=#1,
			title={#2},
		}
}
% Instruction
\tcbset{
	itc/.style 2 args={
			% colframe={#1},
			fonttitle=\bfseries,
			attach boxed title to top center={yshift=-2mm},
			title={#2},
		}
}
% Flip 180
\tcbset{
	aide/.style={
			tikz={rotate=180, transform shape}
		}
}

% For side inside box
\NewTColorBox{isd}{D(){black}D<>{}}{%
side={#1},
#2
}

\tcbset{
	side/.style={
			arc=0pt, boxsep=0mm, notitle, oversize, nobeforeafter, frame hidden,
			enhanced,
			colframe=#1, colback=#1back,
			sidebyside, sidebyside align=center, valign=center
		}
}
\tcbset{
	cnt/.style={
			halign=center,
			halign lower=center
		}
}

% For side adapt box
\NewDocumentCommand{\sde}{sO{box}r()D<>{}d""mmm}{%
	\tcbsidebyside[
		base,
		colframe=#3,
		sidebyside adapt=#4,
		icon=\IfBooleanTF{#1}{#5}{#3},
		#2={#3}{#6},
	]{#7}{#8}
}
\NewDocumentCommand{\sds}{sO{box}r()D<>{}d""mmm}{%
	\tcbsidebyside[
		base,
		step=#3,
		colframe=#3,
		sidebyside adapt=#4,
		icon=\IfBooleanTF{#1}{#5}{#3},
		#2={#3}{\csname name#3\endcsname~\expandafter\csname the#3\endcsname~:~#6},
	]{#7}{#8}
}

% Useful styles to add to a box
\tcbset{heart/.style={overlay={
					\node[below left] at (frame.north west)
					{\includegraphics[width=1.2cm]{\PREPA/figures_generales/heart.jpg}};}}}

\tcbset{hand/.style={overlay={
					\node[below left] at (frame.north west)
					{\includegraphics[width=1.2cm]{\PREPA/figures_generales/pr.jpg}};}}}

\tcbset{dngr/.style={overlay={
					\node[below left, scale=2] at (frame.north west)
					{\danger};}}}

\tcbset{trans/.style={overlay={
					\node[xshift=-0.8cm, yshift=-0.75cm] at (frame.north west)
					{\includegraphics[angle=-90, origin=c, height=1.2cm]{\PREPA/figures_generales/pr.jpg}};}}}

\newcommand{\includehand}[2]{
	\includegraphics[angle=#1,
		origin=c,
		height=#2]{\PREPA/figures_generales/pr.jpg}
}

\newcommand{\includeheart}[2]{
	\vspace*{-20pt}
	\includegraphics[angle=#1,
		origin=c,
		height=#2]{\PREPA/figures_generales/heart.jpg}
}

% For bigger boxrule in fbox
\edef\oldfboxrule{\the\fboxrule}
\newcommand{\fatbox}[1]{\setlength{\fboxrule}{1pt}\fbox{#1}\setlength{\fboxrule}{\oldfboxrule}}

% Journal abbreviations
\newcommand*\aap{A\&A}
\let\astap=\aap
\newcommand*\aapr{A\&A~Rev.}
\newcommand*\aaps{A\&AS}
\newcommand*\actaa{Acta Astron.}
\newcommand*\aj{AJ}
\newcommand*\ao{Appl.~Opt.}
\let\applopt\ao
\newcommand*\apj{ApJ}
\newcommand*\apjl{ApJ}
\let\apjlett\apjl
\newcommand*\apjs{ApJS}
\let\apjsupp\apjs
\newcommand*\aplett{Astrophys.~Lett.}
\newcommand*\apspr{Astrophys.~Space~Phys.~Res.}
\newcommand*\apss{Ap\&SS}
\newcommand*\araa{ARA\&A}
\newcommand*\azh{AZh}
\newcommand*\baas{BAAS}
\newcommand*\bac{Bull. astr. Inst. Czechosl.}
\newcommand*\bain{Bull.~Astron.~Inst.~Netherlands}
\newcommand*\caa{Chinese Astron. Astrophys.}
\newcommand*\cjaa{Chinese J. Astron. Astrophys.}
\newcommand*\fcp{Fund.~Cosmic~Phys.}
\newcommand*\gca{Geochim.~Cosmochim.~Acta}
\newcommand*\grl{Geophys.~Res.~Lett.}
\newcommand*\iaucirc{IAU~Circ.}
\newcommand*\icarus{Icarus}
\newcommand*\jcap{J. Cosmology Astropart. Phys.}
\newcommand*\jcp{J.~Chem.~Phys.}
\newcommand*\jgr{J.~Geophys.~Res.}
\newcommand*\jqsrt{J.~Quant.~Spectr.~Rad.~Transf.}
\newcommand*\jrasc{JRASC}
\newcommand*\memras{MmRAS}
\newcommand*\memsai{Mem.~Soc.~Astron.~Italiana}
\newcommand*\mnras{MNRAS}
\newcommand*\na{New A}
\newcommand*\nar{New A Rev.}
\newcommand*\nat{Nature}
\newcommand*\nphysa{Nucl.~Phys.~A}
\newcommand*\pasa{PASA}
\newcommand*\pasj{PASJ}
\newcommand*\pasp{PASP}
\newcommand*\physrep{Phys.~Rep.}
\newcommand*\physscr{Phys.~Scr}
\newcommand*\planss{Planet.~Space~Sci.}
\newcommand*\pra{Phys.~Rev.~A}
\newcommand*\prb{Phys.~Rev.~B}
\newcommand*\prc{Phys.~Rev.~C}
\newcommand*\prd{Phys.~Rev.~D}
\newcommand*\pre{Phys.~Rev.~E}
\newcommand*\prl{Phys.~Rev.~Lett.}
\newcommand*\procspie{Proc.~SPIE}
\newcommand*\qjras{QJRAS}
\newcommand*\rmxaa{Rev. Mexicana Astron. Astrofis.}
\newcommand*\skytel{S\&T}
\newcommand*\solphys{Sol.~Phys.}
\newcommand*\sovast{Soviet~Ast.}
\newcommand*\ssr{Space~Sci.~Rev.}
\newcommand*\zap{ZAp}

%%% Fin du package
\endinput
